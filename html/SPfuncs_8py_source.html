<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Test Cmd Line: SPfuncs.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Test Cmd Line
   &#160;<span id="projectnumber">V1</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('SPfuncs_8py_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SPfuncs.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SPfuncs_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html">    1</a></span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"># Useful functions for processing the SP data. Hopefully some are generic enough to be used elsewhere too.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">from</span> pylab <span class="keyword">import</span> *</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">import</span> matplotlib</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">from</span> matplotlib.gridspec <span class="keyword">import</span> GridSpec, GridSpecFromSubplotSpec</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">from</span> scipy <span class="keyword">import</span> stats</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">import</span> pdb</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> curve_fit</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">from</span> scipy.ndimage <span class="keyword">import</span> convolve1d</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">import</span> os</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">from</span> itertools <span class="keyword">import</span> count</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">import</span> re</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">import</span> MT, MF</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">from</span> MT <span class="keyword">import</span> nonnan, cached_property, nancurve_fit, figDontReplace, running_median_insort, vprint</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">from</span> scipy <span class="keyword">import</span> random</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">from</span> scipy.signal <span class="keyword">import</span> windows</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">from</span> statsmodels <span class="keyword">import</span> api <span class="keyword">as</span> sm</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">#from SPDataSet import SPDataSet</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a47dc9e4b5eebaf862bdd545eaff5c371">   26</a></span>&#160;bTest=<span class="keyword">False</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">   28</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(secs):</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">return</span> secs/23.9344696/3600;</div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aca5c571c3ee666190d0568fbcd72f1a9">   30</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aca5c571c3ee666190d0568fbcd72f1a9">sd2secs</a>(sd):</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">return</span> sd*23.9344696*3600;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5f881c246a0ac49955b33746df6c379b">   33</a></span>&#160;Window =namedtuple(<span class="stringliteral">&#39;Window&#39;</span>, [<span class="stringliteral">&#39;duration&#39;</span>, <span class="stringliteral">&#39;offset&#39;</span>])</div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#abeb96363789885a36812850590fbfbab">   34</a></span>&#160;RotationSpec=namedtuple(<span class="stringliteral">&#39;RotationSpec&#39;</span>, [<span class="stringliteral">&#39;startingAngle&#39;</span>, <span class="stringliteral">&#39;delay&#39;</span>, <span class="stringliteral">&#39;interval&#39;</span>, <span class="stringliteral">&#39;rotAngles&#39;</span>, <span class="stringliteral">&#39;extraRotAngle&#39;</span>, <span class="stringliteral">&#39;numRotations&#39;</span>]);</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a29a04cecefb141502380f4e43bc1d06d">   35</a></span>&#160;RawData=namedtuple(<span class="stringliteral">&#39;RawData&#39;</span>, [<span class="stringliteral">&#39;t&#39;</span>, <span class="stringliteral">&#39;sig&#39;</span>])</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a1ffb0a48d6d36a1260a65e82c4604ce2">   36</a></span>&#160;PointData=namedtuple(<span class="stringliteral">&#39;PointData&#39;</span>, [<span class="stringliteral">&#39;t&#39;</span>, <span class="stringliteral">&#39;sig&#39;</span>, <span class="stringliteral">&#39;err&#39;</span>, <span class="stringliteral">&#39;chi2&#39;</span>, <span class="stringliteral">&#39;theta&#39;</span> ])</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">   37</a></span>&#160;CorrelationData=namedtuple(<span class="stringliteral">&#39;CorrelationData&#39;</span>, [<span class="stringliteral">&#39;t&#39;</span>, <span class="stringliteral">&#39;sig&#39;</span>, <span class="stringliteral">&#39;err&#39;</span>, <span class="stringliteral">&#39;chi2&#39;</span>, <span class="stringliteral">&#39;theta&#39;</span>])</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a8dd105859db0f7ebef805efb3c08dfb7">   38</a></span>&#160;SiderealFitData=namedtuple(<span class="stringliteral">&#39;SiderealFitData&#39;</span>, [<span class="stringliteral">&#39;t&#39;</span>, <span class="stringliteral">&#39;sig&#39;</span>, <span class="stringliteral">&#39;err&#39;</span>, <span class="stringliteral">&#39;chi2&#39;</span>, <span class="stringliteral">&#39;sidTheta&#39;</span>,<span class="stringliteral">&#39;labTheta&#39;</span>, <span class="stringliteral">&#39;meta&#39;</span>])</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98ebdcd3ceb3fa1b7bc74e8caf64b50d">   39</a></span>&#160;LabSetData=namedtuple(<span class="stringliteral">&#39;LabSetData&#39;</span>, [<span class="stringliteral">&#39;t&#39;</span>, <span class="stringliteral">&#39;sig&#39;</span>, <span class="stringliteral">&#39;err&#39;</span>, <span class="stringliteral">&#39;chi2&#39;</span>, <span class="stringliteral">&#39;labTheta&#39;</span>])</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aba724f914a5cc838851518564a1f5d84">   43</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aba724f914a5cc838851518564a1f5d84">getRotationsFromRSpec</a>(rSpec, numReps=1):</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> iterable(rSpec.rotAngles):</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        rotAngles=[rSpec.rotAngles]</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        rotAngles=rSpec.rotAngles</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    rotationSequence=array( [rSpec.extraRotAngle]+ [rotAngles[k] <span class="keywordflow">for</span> k <span class="keywordflow">in</span> arange(rSpec.numRotations-1, dtype=<span class="stringliteral">&#39;i4&#39;</span>)%len(rotAngles)])</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    allRotations=tile(rotationSequence, numReps)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">return</span> allRotations</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">#  Return angles for the sequence defined by @rSpec, repeated @numReps times.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">#     Angles are that /before/ each rotation, including before the extraRotation</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a2533afa952ea007cfad4a1deb6a607a5">   56</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a2533afa952ea007cfad4a1deb6a607a5">getAnglesFromRSpec</a>(rSpec, numReps=1):</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">#Logic here is a little screwy. We start with extraRotAngle then subtract it from everything</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment"># Also remember, following the logic on spin-doctor we only do the main rotation N-1 times, the last one being the &#39;extraRotation&#39;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    allRotations=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aba724f914a5cc838851518564a1f5d84">getRotationsFromRSpec</a>(rSpec, numReps)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    allAngles= rSpec.startingAngle-rSpec.extraRotAngle + cumsum(allRotations)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    allAngles=allAngles.reshape((numReps, rSpec.numRotations))</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">#allAngles=allAngles[:,:-1]</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">#allAngles=tile(angles, (numReps,1) )+arange(numReps)[:,newaxis]*rSpec.extraRotAngle</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">return</span> allAngles</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">#  Construct a set of triggers by analysing the timing for the</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">#     signal.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af8a48b74a6d4e725e2409329126076a6">   71</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af8a48b74a6d4e725e2409329126076a6">makeTriggers</a>(sd,rSpec, seqStartTimes=None, bIncludeExtraRot=True, gapBetween=False):</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    sdDiff=np.diff(sd); </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    meanDt=np.mean(sdDiff) <span class="comment"># Mean difference between 1 point and the next (should be 0.02s ish)</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    meanDt=np.median(sdDiff) <span class="comment"># (Maybe using the median will be more robust?)</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span> gapBetween:</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        vprint(<span class="stringliteral">&quot;You probably shouldn&#39;t be using the gapBetween argument to makeTriggers&quot;</span>)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        gapBetween=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(gapBetween)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        dataTime=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(rSpec.numRotations*rSpec.interval+rSpec.delay)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        seqStartTimes=arange(sd[0],sd[-1]-dataTime, (dataTime +gapBetween) )</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span> seqStartTimes <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        mask=np.hstack([[<span class="keyword">True</span>], sdDiff&gt;8*meanDt]) <span class="comment">#Make a mask array for where the difference is much greater than the average</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">#The above should perhaps not start with at true, but a false? I imagine we start recording data BEFORE we send the first trigger, not the other-way around?</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        seqStartTimes=sd[mask]; <span class="comment">#We&#39;ll assume those points are where each sequence of rotations starts</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">if</span> len(seqStartTimes)==1:</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            vprint(<span class="stringliteral">&quot;Maybe there&#39;s no gaps in the sequence? makeTriggers is only returning one set of triggers&quot;</span>)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    Ntrigs = rSpec.numRotations-1</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> bIncludeExtraRot:</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        Ntrigs+=1</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    group=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(np.arange(Ntrigs)*rSpec.interval+rSpec.delay); <span class="comment">#A group is a group of triggers for 1 sequence</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    trigTimes=[group+seqStartTimes[0]]; <span class="comment">#Trig will be the list of all triggers which we slowly build up.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, seqStartTimes.size): <span class="comment">#(this could be easily vectorized, as the size of trigTimes is known in advance)</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">if</span> trigTimes[-1][-1]&lt;seqStartTimes[i]:</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            trigTimes.append(group+seqStartTimes[i])</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">#angles=getAnglesFromRSpec(rSpec, seqStartTimes.size)#, bIncludeExtraRot=bIncludeExtraRot)</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">return</span> np.array(trigTimes)<span class="comment">#, np.array(angles)</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">#  Cut up the times @t into sections that start at t_0 and and at t_end OR t_0 + delta_t if they&#39;re all the same.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">#         Returns a list of index arrays with length t_0.size</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">#         </span></div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a87aac33304db20fd58d7a3625061cca6">  108</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a87aac33304db20fd58d7a3625061cca6">sliceSorted</a>(t, t_0, t_end=None, delta_t=None):</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        startIs=t.searchsorted(t_0.ravel()); <span class="comment">#ravel here because x0 can be multi-d</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span> t_end <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            endIs = t.searchsorted(t_end.ravel())</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">if</span> delta_t <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;should have t_end OR delta_t, not both!&quot;</span>)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">elif</span> delta_t:</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            endIs = t.searchsorted(t_0.ravel()+delta_t)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        startIs=startIs[endIs&lt;t.size] <span class="comment">#Throw out cuts where the end index is out of range</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        endIs=endIs[:startIs.size]</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">if</span> t_0.ndim&gt;1:</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="comment">#If we lose some part so we have an incomplete sequence, we&#39;ll dump them.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            Norphans=startIs.size%t_0.shape[-1] <span class="comment">#this is only general for 2d- need rethinking for more dimensions</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span> Norphans&gt;0:</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                startIs=startIs[:-Norphans]</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                endIs=endIs[:-Norphans]</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            newShape=[int(startIs.size/t_0.shape[-1]), t_0.shape[-1]]</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">else</span>: </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            newShape=[endIs.size]</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        indxL=empty(newShape, dtype=<span class="stringliteral">&#39;O&#39;</span>)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        indxL.ravel()[:]=[np.r_[sI:eI] <span class="keywordflow">for</span> sI,eI <span class="keywordflow">in</span> zip(startIs, endIs)]</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">return</span> indxL</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"># Cut the given x data at points starting from x0, and going to x0+delta_x, and perform the functions in functionL on each cut section. </span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">#         Returns meanXs. finalL, indxL</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">#         </span></div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#afac5173c60ef10bac3b5eafb40f7efef">  141</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#afac5173c60ef10bac3b5eafb40f7efef">sliceReduceData</a>(x, y, x0, delta_x=None,endTimes=None, functionL=[np.size, np.mean, lambda vals, **kwargs: np.std(vals, **kwargs)/sqrt(np.size(vals))],  bJustGiveCuts=<span class="keyword">False</span> ):</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">if</span> endTimes <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            endTimes = x0 + delta_x</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        indxL=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a87aac33304db20fd58d7a3625061cca6">sliceSorted</a>(x, x0, t_end=endTimes);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span> y.ndim==1:</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            y=y[newaxis,:]</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        tPtsL=[x[inds] <span class="keywordflow">for</span> inds <span class="keywordflow">in</span> indxL.flat]</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        finalL=[]</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">for</span> yax <span class="keywordflow">in</span> y:</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            yPtsL=[yax[inds] <span class="keywordflow">for</span> inds <span class="keywordflow">in</span> indxL.flat]</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            resL=[]</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">for</span> f <span class="keywordflow">in</span> functionL: <span class="comment">#Apply each function in the list to the cuts</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                    vals=[f(ys, axis=0) <span class="keywordflow">for</span> ys <span class="keywordflow">in</span> yPtsL]</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                    vals=array(vals).reshape(indxL.shape)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                    resL.append(vals)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            processedL=np.array(resL)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            finalL.append(processedL)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        meanXs= (x0+endTimes)/2.<span class="comment"># delta_x/2. # The mean time for each cut</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        meanXs=meanXs.ravel()[:indxL.size].reshape(indxL.shape)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">if</span> len(finalL)==1:</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            finalL=finalL[0]</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">return</span> meanXs, finalL, indxL    </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7fb1286952274a8a185975238894be9d">  170</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7fb1286952274a8a185975238894be9d">stringSimple3pt</a>(x, err=None):</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    coeffs=array([0.25, -0.5, 0.25])</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    coeffs/=abs(coeffs).sum()</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    cnv=convolve1d(x, coeffs, axis=0, mode=<span class="stringliteral">&#39;constant&#39;</span>)[1:-1]</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> len(cnv.shape)&gt;1:</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        res=cnv.mean(axis=1) <span class="comment"># Or median?</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">if</span> err <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;if x is 2d, this function will calculate errors so errors shouldn&#39;t be included&quot;</span>)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        err3pt = std(cnv, axis=1)/sqrt(x.shape[0])</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">else</span>: </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        res=cnv</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        err3pt= sqrt(convolve(err**2, coeffs**2,mode=<span class="stringliteral">&#39;valid&#39;</span>))</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    st3pt=res* (arange(res.size)%2-0.5)*-2 <span class="comment">#Multiply by [1,-1,1,-1]....</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> st3pt, err3pt</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment"># Calculate 5pt strings and errors</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a26157a1627869c31bfa6e494e5caf311">  190</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a26157a1627869c31bfa6e494e5caf311">stringSimple5pt</a>(x, err=None, rotDir=1.):</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">#coeffs=array([0.25, -0.5, 0.25]) #Copy coefficients from matlab code</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    coeffs=array([</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;       [ 0.25 ,  0., -0.5,  0. ,  0.25],</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        [-0.25  ,  0.5   ,  0.    , -0.5   ,  0.25],</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;       [ 0.125     , -0.25      ,  0.25      , -0.25      ,  0.125     ]])</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">#coeffs=array([[1.,0.,-2.,0.,1.], #1h0</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">#            [-1,2.,0.,-2.,1.], #1h90</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">#            [1,-2, 2, -2, 1]], #2h0</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">#            )</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">#coeffs.T[:]/=abs(coeffs).sum(axis=1)</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    N=len(x)-4</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    resA=zeros([N, 4])</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    errA=zeros([N, 4])</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">for</span> cf, r, e <span class="keywordflow">in</span> zip(coeffs, resA.T, errA.T):</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        cnv=convolve1d(x, cf, axis=0, mode=<span class="stringliteral">&#39;constant&#39;</span>)[2:-2]</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="comment">#cnv=convolve1d(x, coeffs, axis=0, mode=&#39;constant&#39;)[2:-2]</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">if</span> len(cnv.shape)&gt;1: <span class="comment">#If x is 2d, we&#39;ll assume that each column represents repeated measurements of the same value</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            thisRes=cnv.mean(axis=1) <span class="comment"># (Maybe median would be better here?)</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="keywordflow">if</span> err <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;if x is 2d, this function will calculate errors so errors shouldn&#39;t be included&quot;</span>)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            thisErr = std(cnv, axis=1)/sqrt(x.shape[0])</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">else</span>: </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            res=cnv</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            thisErr= sqrt(convolve(err**2, cf**2,mode=<span class="stringliteral">&#39;valid&#39;</span>)[2:-2])</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        r[:]=thisRes</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        e[:]=thisErr</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    resA[:,-1]*=nan</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    res1h=(resA[:,0] + 1j*resA[:,1])*exp(-1j*pi/2*arange(N))<span class="comment">#%2-0.5)*-2</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    err1h=(errA[:,0] + 1j*errA[:,1])*exp(+1j*pi/2*arange(N)) <span class="comment">#(arange(N)%2-0.5)*-2</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    errA[:,0],errA[:,1]=abs(err1h.real), abs(err1h.imag)</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    resA[:,0]=res1h.real</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    resA[:,1]=res1h.imag</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    resA[:,2]=resA[:,2]*(arange(N)%2-0.5)*-2</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">#st0=res[::2]</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">#st90=res[1::2]</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">#err0=err[::2]</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">#err90=err[1::2]</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">#st0=st0* (arange(st0.size)%2-0.5)*-2 #Multiply by [1,-1,1,-1]....</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">#st90=st90* (arange(st90.size)%2-0.5)*-2 #Multiply by [1,-1,1,-1]....</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">return</span> resA.reshape([N,2,2]), errA.reshape([N,2,2])</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment"># Calculate the harmonics present in the data x corresponding to phases theta.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">#     Here we&#39;ll fit to sin waves.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">#     Inputs theta_in, x_in, and errs_in may be 2d</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">#     Returns:</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">#         thL, ampL, covL (thetas, fitted a#mplitude, covariance- except currently only the diagonal components, i.e. variance)</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7590e0785adc48ccbabea8d0eccda514">  245</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7590e0785adc48ccbabea8d0eccda514">getHarmonicsFit</a>( theta_in, x_in, errs_in=None, harmonics=[1], pars0=[1.,1.]):</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    bOnlyOneHarmonic=<span class="keyword">False</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(harmonics, <span class="stringliteral">&#39;__len__&#39;</span>): <span class="comment">#If we haven&#39;t been given a list of harmonics, we&#39;ll assume it&#39;s a number</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        bOnlyOneHarmonic=<span class="keyword">True</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    theta_in=theta_in.ravel()</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    x_in=x_in.ravel()</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">#errs_in=errs_in[</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    errs_in=errs_in.ravel()</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">#if errs_in==None:</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">#errs_in=ones(x.shape, dtype=x.dtype)</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">#d_theta=theta[1]-theta[0]</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">#theta=arange(0, d_theta*N, d_theta)</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    N=theta_in.size</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    thL=[]</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    ampL=[]</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    covL=[]</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    chi2L=[]</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    delt=0.1</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    THx=theta_in[0]</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    THy=THx+pi/2. <span class="comment">#This is the sin phase, so it&#39;s before cos </span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    theta = theta_in-THx</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    p_mn0=nanmean(x_in)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">#x=x_in-nanmean(x_in)</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    x=x_in</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    bSinQuad=<span class="keyword">True</span>;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    bCosQuad=<span class="keyword">True</span>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    bTest=<span class="keyword">False</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> bTest:</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        fig, [ax, ax2]=subplots(2,1)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="comment">#ax=gca()</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        ax.plot(theta_in, x)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="comment">#ax.plot(theta_in, x_in, &#39;ro&#39;)</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        ax.plot(theta_in, x, <span class="stringliteral">&#39;bo&#39;</span>)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">for</span> n <span class="keywordflow">in</span> harmonics:</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">if</span> sum(abs(sin(theta[~isnan(x)])))/N &lt;0.1: <span class="comment"># Means there&#39;s not much data for the sin quadrature</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            bSinQuad=<span class="keyword">False</span>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">if</span> bSinQuad <span class="keywordflow">and</span> bCosQuad:</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="comment">#[Ax, Ay, B], cov=nancurve_fit(lambda theta, ax,ay,b: ax*cos(n*theta)+ ay*sin(n*theta) + b, theta, x,p0=[0.5e-1,0.5e-1,1.],sigma=errs_in)# [0][0] #sin(n*theta)*x;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            f=<span class="keyword">lambda</span> theta, ax,ay, mn: ax*sin(n*theta)+ ay*cos(n*theta) + mn</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            [Ax, Ay, Xmn], cov=nancurve_fit(f, theta, x,p0=pars0+[p_mn0],sigma=errs_in**2, )<span class="comment">#, absolute_sigma=True)# [0][0] #sin(n*theta)*x;</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordflow">if</span> bTest:</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                ax2.plot(theta_in, f(theta, Ax, Ay, Xmn))</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            chi2= nansum((f(theta, Ax, Ay, Xmn)-x)**2*1./errs_in**2)/(sum(~isnan(x).ravel())-2)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">elif</span> bCosQuad:</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="comment">#[Ax, B],cov=nancurve_fit(lambda theta, ax,b: ax*cos(n*theta) + b, theta, x,p0=[0.5e-1,1.],sigma=errs_in)</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            f=<span class="keyword">lambda</span> theta, ay, mn: ay*cos(n*theta) + mn</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            [Ay, Xmn],cov=nancurve_fit(f, theta, x,p0=[pars0[0], p_mn0],sigma=errs_in)<span class="comment">#, absolute_sigma=True)</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">if</span> bTest:</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                ax2.plot(theta_in, f(theta, Ay, Xmn))</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            Ax=nan</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            THx=nan</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            cov=array([[nan, nan], [nan, cov[0,0]]]) <span class="comment"># Let&#39;s pretend we&#39;ve got realy covariance</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            chi2= nansum((f(theta, Ay, Xmn)-x)**2*1./errs_in**2)/(sum(~isnan(x).ravel())-1)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordflow">elif</span> bSinQuad: </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            f=<span class="keyword">lambda</span> theta, ax, mn: ax*sin(n*theta) + mn</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            [Ax, Xmn],cov=nancurve_fit(f , theta, x,p0=[pars0[1], p_mn0],sigma=errs_in)<span class="comment">#, absolute_sigma=True)</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keywordflow">if</span> bTest:</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                ax2.plot(theta_in, f(theta, Ax, Xmn))</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            Ay=nan</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            cov=array([[cov[0,0], nan], [nan, nan]]) <span class="comment"># Cheating</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            chi2= nansum((f(theta, Ax, Xmn)-x)**2*1./errs_in**2)/(sum(~isnan(x).ravel())-1)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Error in getHarmonicsFit: input angles are probably unexpected?&#39;</span>)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">if</span> bTest:</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            show()</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            raw_input(<span class="stringliteral">&#39;Continue?&#39;</span>)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">if</span> bOnlyOneHarmonic:</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            covL=cov</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            ampL=(Ax,Ay)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            thL=(THx, THy)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            covL.append(cov)</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            ampL.append((Ax,Ay))</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            thL.append((THx, THy))</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            chi2L.append(chi2)</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="comment">#covL.append(sqrt(diag(cov)))</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">#covL.append((sqrt(cov_x[0][0]), sqrt(cov_y[0][0])))</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">return</span> thL, ampL, covL, chi2L</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">#  Input measurements x taken at angles theta0+ n* dtheta (assumed to be evenly spaced) and return harmonic components</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">#     Returns: phi, amp, err, chi2</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">#     where they each have the shape</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">#     [ (val1, val2), (val1, val2)... ], where each tuple corresponds to a different harmonic and the individual components correspond to the different quadratures.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">#     incalculable values are replaced with &quot;nan&quot;</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">#     That is, return the coefficients A1, A2 that fit the data for A1*sin(n*theta) + A2*cos(n*theta) for harmonic n, as well as standard deviations and chi^2</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a154be474c56db17750f8232efe410d54">  339</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a154be474c56db17750f8232efe410d54">mgStringHarmonics</a>(theta, x, err=None, harmonics=[1], chi2Filter=inf):</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment"># We&#39;ll assume that theta is evenly spaced for the moment</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    assert(theta.shape[0]==x.shape[0])</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    theta0=theta[0]</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    dtheta=theta[1]-theta[0]</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">if</span> any(abs(diff(diff(theta)))&gt;0.1): <span class="comment"># Is the _change_ in step-size changing? (Why do we care??)</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span> any(abs(abs(diff(theta))-pi) &gt;0.1): <span class="comment">#Maybe we&#39;re going back and forth by 180, in which case we can still operate</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;Theta values are apparently not evenly spaced. stringHarmonics can&#39;t handle this (yet)&quot;</span>)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (2*pi-0.05)%abs(dtheta) &lt; 0.1:</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;string harmonics only implemented for dtheta that fits evenly into 2*pi&quot;</span>)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">#drnL=</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">for</span> H <span class="keywordflow">in</span> harmonics:<span class="comment">#range(4)+1:  #count():</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        rem=(pi+0.1)%(H*abs(dtheta))</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">if</span> abs(rem)&lt;0.2: <span class="comment"># Check that the angles are suitable, i.e. they&#39;re all at near 0, pi</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            div=(pi)/(H*dtheta) <span class="comment">#How many steps to get to a pi change in the signal</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            nptString= round(2*abs(div)+1) <span class="comment">#Use this to calculate the number of string points to use</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="comment">#Throw away outliers, without considering correlations</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">if</span> x.ndim&gt;1:</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                pterr=nanstd(x, axis=-1)</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                pts=nanmean(x, axis=-1)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                pts=x</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            badMask=isnan(pts)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="keywordflow">while</span> 1:</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                inv_variance=1./pterr**2</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                inv_variance_sum=nansum(inv_variance[~badMask])</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                sampleMean=nansum(pts[~badMask]*inv_variance[~badMask])/inv_variance_sum</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                zsq=(pts-sampleMean)**2*inv_variance/inv_variance_sum</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                zsq[badMask]=nan</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                biggestDev=nanmax(zsq)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keywordflow">if</span> biggestDev&gt;20 <span class="keywordflow">and</span> 0:</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    I=nanargmax(zsq)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    badMask[I]=<span class="keyword">True</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <span class="keywordflow">if</span> sum(badMask)&gt;5:</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                        badMask[:]=<span class="keyword">True</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                        vprint(<span class="stringliteral">&quot;Unrecoverable seq (too many points deviate)&quot;</span>)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                        <span class="keywordflow">break</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    <span class="keywordflow">break</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            x[badMask]=nan    </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="comment">#result = [[ nan,  nan ]], [[ nan, nan ]], [[[ nan, nan ],[ nan,nan ]]], [[ nan, nan ]]</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            minNumPts=2*nptString+1</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">if</span> nptString==3:</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                st, stErr = <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7fb1286952274a8a185975238894be9d">stringSimple3pt</a>(x, err)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                seq1, seqErr1, seqChi21=  MT.fancy_column_stats(st, stErr, cf=3, chi2Max=chi2Filter, Nmin=5)</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                result = array([[theta0, nan]]), array([seq1]), array([seqErr1]), array([seqChi21])</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <span class="keywordflow">elif</span> nptString==5:</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                st, stErr= <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a26157a1627869c31bfa6e494e5caf311">stringSimple5pt</a>(x, err, rotDir=sign(dtheta))</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                seq1, seqErr1, seqChi21=  MT.fancy_column_stats(st[:,0], stErr[:,0], cf=5, chi2Max=chi2Filter, Nmin=5)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                seq2, seqErr2, seqChi22=  MT.fancy_column_stats(st[:,1], stErr[:,1], cf=5, chi2Max=chi2Filter, Nmin=5)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                result = array([[theta0, theta0-dtheta], [theta0, nan+theta0+abs(dtheta)/2]]), array([seq1, seq2]), array([seqErr1, seqErr2]), array([seqChi21, seqChi22])</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                vprint(<span class="stringliteral">&quot;th:{}, seq2:{}&quot;</span>.format(theta0%(2*pi), seq2))</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                print(<span class="stringliteral">&quot;nptString is {0}&quot;</span>.format(nptString))</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="comment"># CHI2 ELIMINATION</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="comment">## While the set of string points doesn&#39;t fit a chi2 model, we eliminate the largest deviating points</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">if</span> 0:</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <span class="keywordflow">while</span> 1:</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    inv_variance=1./stErr**2; <span class="comment"># Variance from individual error bars</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    inv_variance_sum=nansum(inv_variance)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    ampFinal=nansum(st*inv_variance)/inv_variance_sum</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    N=sum(~isnan(st))</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                    cf=3.*((N-1)/N)**2<span class="comment"># &#39;Correlation factor&#39;: Used to be 2.54. This stuff is (ftm) worked out emprically</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    degOfF=N/cf </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                    devSq=(st-ampFinal)**2*inv_variance</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                    chi2=nansum(devSq)/degOfF; <span class="comment">#: = var(st)/varfromerrorbars Needs checking too.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    <span class="keywordflow">if</span> chi2&gt;chi2Filter:</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                        I=nanargmax(devSq)<span class="comment">#/nanvar(st)</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        <span class="comment">#I=nanargmax(dev)</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        st[I]=nan</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        stErr[I]=nan</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        <span class="keywordflow">if</span> sum(~isnan(st))&lt;minNumPts: <span class="comment">#if we have too few points left</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                            print(<span class="stringliteral">&quot;too many bad string points (by chi2 limit) &quot;</span>),</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                            st[:]=nan</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                            stErr[:]=nan</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                            ampFinal=nan</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                        <span class="keywordflow">break</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <span class="comment">#Decide if there were too many points thrown out:</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                N=sum(~isnan(st))</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                <span class="keywordflow">if</span> N &lt; minNumPts <span class="keywordflow">and</span> 1: <span class="comment">#If there&#39;s less than a few independent string points remaining, we&#39;ll give up</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    <span class="comment">#vprint(&quot;Unrecoverable sequence&quot;)</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    <span class="keywordflow">return</span> [(theta0, nan)], [(nan, nan)], [[[nan,nan],[nan,nan]]], [(nan, nan)]</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                <span class="comment">#adjDegOfF=stats.chi2.ppf(.5, N -2.549); #Adjusted degrees of freedom for calculating chi2</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                cf=3.*((N-1)/N)**2<span class="comment"># Used to be 2.54. This stuff is (atm) worked out emprically</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                degOfF=N/cf </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                chi2=nansum(((st-ampFinal)**2)*inv_variance)/degOfF; <span class="comment">#: = var(st)/varfromerrorbars Needs checking too.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                errFinal=sqrt(nansum((st-ampFinal)**2*inv_variance/inv_variance_sum)/degOfF*sqrt(2))<span class="comment">#/sqrt(1-stats.chi2.cdf(chi2, degOfF));</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                <span class="comment">#Assemble the results</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                result[0][0]=[theta0,nan]</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                result[1][0]=[ampFinal,nan]</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                result[2][0]=[[[errFinal,nan],[nan,nan]]]</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                result[3][0]=[[chi2,nan]]</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="comment">#return [(theta0, nan)], [(ampFinal, nan)], [[[errFinal,nan],[nan,nan]]], [(chi2, nan)]</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            print(<span class="stringliteral">&quot;abs(rem)!&lt;0.2 for dtheta = {0}, H = {1}. Can&#39;t do string analysis on these&quot;</span>.format(dtheta, H))</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="comment">#This should probably raise an exception</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    </div>
<div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#acb6d178d4325b6c3d8fec4f8197d6819">  457</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#acb6d178d4325b6c3d8fec4f8197d6819">renameFieldMaybe</a>(recArray, oldName, newName):</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        names=list(recArray.dtype.names)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            I=names.index(oldName)</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            names[I]=newName</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            recArray.dtype.names=names</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">except</span> ValueError:</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">pass</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">return</span> recArray</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">#  Add fake signal/noise to an existing signal</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9cc828a26b8f8d72c9c5c86bd951f8e8">  471</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9cc828a26b8f8d72c9c5c86bd951f8e8">addFakeData</a>(rawAmp, apparatusAngles=None,trigs=None, rotationRate=None, amp=1., sigma=0., phi=0, amp2=0, phi2=0, zeroingTime=100, fracDev=0, sizeDev=0.1, fastAddF=None, bBlankOriginalData=False):</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    sd=rawAmp.t</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    sig=rawAmp.sig.copy()</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> bBlankOriginalData:</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        sig*=0</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> apparatusAngles <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        theta= 2*pi*sd +phi+ apparatusAngles[:,:,newaxis] <span class="comment"># Angle of the apparatus with respect to the cosmo   </span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="comment"># Now to cut the data into &#39;sequences&#39;</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="comment">#seqStartTimes=arange(0,totTime, secs2sd(rSpec.delay + rSpec.interval*rSpec.numRotations + zeroingTime))+startTime</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="comment">#thPtsL=[theta[inds] for inds in indxL.flat]</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="comment">#apparatusAngles=getAnglesFromRSpec(rSpec, numReps=len(pretrigs))/180.*pi</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="comment">#theta=hstack(array(thPtsL) +apparatusAngles.ravel()[:len(thPtsL)])</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="comment">#flat_ind=indxL.ravel() #OR something else??</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">elif</span> rotationRate <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        theta= 2*pi*sd + phi + 2*pi*rotationRate*<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aca5c571c3ee666190d0568fbcd72f1a9">sd2secs</a>(sd)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;Need to include either apparatusAngles or rotationRate&quot;</span>)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    fast_noiseF=<span class="keyword">lambda</span> t: random.normal(size=t.size, scale=sigma) <span class="keywordflow">if</span> sigma&gt;0 <span class="keywordflow">else</span> 0</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    sig+= amp*sin(theta) + amp2*sin(2*theta+phi2) <span class="comment">#add base signal</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment">#Random outlier additions:</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    sig+= where(rand(*sig.shape)&gt;fracDev, 0, sizeDev)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">#hstack([zeros(inds.shape) if rand()&gt;fracDev else sizeDev*ones(inds.shape) for inds in indxL.flat ])</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">#Uniform noise</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">#sd=hstack(tPtsL)</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    sig+= fast_noiseF(sd)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">#Repetitive noise</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span> fastAddF <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        addN=hstack([fastAddF(<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aca5c571c3ee666190d0568fbcd72f1a9">sd2secs</a>(tPts-tPts[0])) <span class="keywordflow">for</span> tPts <span class="keywordflow">in</span> tPtsL ])</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        sig+=addN</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <span class="comment">#sig[ind]+=fastAddF(sd[ind]-sd[ind[0]])</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> bTest:</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        figure(<span class="stringliteral">&#39;TestAddFakeData&#39;</span>)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        ax=subplot(311)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        plot(sd, sig,<span class="stringliteral">&#39;,&#39;</span>)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        subplot(312, sharex=ax)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        plot(trigs.flatten(), apparatusAngles.flatten(),<span class="stringliteral">&#39;-o&#39;</span>)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        subplot(313)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        plot(trigs.flatten(),<span class="stringliteral">&#39;o&#39;</span>)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a29a04cecefb141502380f4e43bc1d06d">RawData</a>(sd, sig)<span class="comment">#SPDataSet(&#39;test&#39;, preloadDict={&#39;fastD&#39;:[sd, sig, [&#39;sig&#39;]]}, rSpec=rSpec)</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">#return SPDataSet(fastD=[sd, sig, [&#39;sig&#39;]])</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">return</span> cutAmpAdded</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">#  Make up some data that the experiment _might_ have measured</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">#     Plan: 1. Make a pure signal, and add some noise. 2. Calculate the component that would be measured in each orientation. 3. Add white noise.. </span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00532"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae90ba18ae292290722e197cf242d8721">  532</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae90ba18ae292290722e197cf242d8721">makeTestData</a>(rSpec, amp=1., amp2=0.0, sigma=5., N=100000, sampleRate=10, phi=0, phi2=0, zeroingTime=100, fracDev=0, sizeDev=0.1, fastAddF=None, startTime=0):</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    S1cosmos=amp*exp(1j*phi)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    S2cosmos=amp2*exp(1j*2*phi2)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    totTime=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(N/sampleRate) <span class="comment">#Total time of the set in sidereal days</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">#zeroingTime=100 #How long to wait between sequences</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">#phi=pi/3 #Signal phase</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    sd= linspace(0,totTime, N) + startTime</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    theta= 2*pi*sd  <span class="comment"># Angle of the room with respect to the cosmos</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    fast_noiseF=<span class="keyword">lambda</span> t: random.normal(size=t.size, scale=sigma)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;   </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment"># Now to cut the data into &#39;sequences&#39;</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    seqStartTimes=arange(0,totTime, <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(rSpec.delay + rSpec.interval*rSpec.numRotations + zeroingTime))+startTime</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    trigs=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af8a48b74a6d4e725e2409329126076a6">makeTriggers</a>(sd, rSpec, seqStartTimes=seqStartTimes, bIncludeExtraRot=<span class="keyword">True</span>);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">#theta=theta/180*pi</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    pretrigs=trigs[:,0]-<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(rSpec.delay)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    startTimes=hstack([pretrigs[:,newaxis],trigs[:,:-1]])</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    endTimes=trigs</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">#tPtsL,thPtsL,indxL= sliceReduceData(sd, theta, x0=startTimes.ravel(), endTimes=endTimes.ravel(), bJustGiveCuts=True)</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">#Get the indices divided up according to the triggers</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    indxL= <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a87aac33304db20fd58d7a3625061cca6">sliceSorted</a>(sd, t_0=startTimes.ravel(), t_end=endTimes.ravel()) <span class="comment">#indices of the points between each rotation</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    tPtsL=[sd[inds] <span class="keywordflow">for</span> inds <span class="keywordflow">in</span> indxL.flat]</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    thPtsL=[theta[inds] <span class="keywordflow">for</span> inds <span class="keywordflow">in</span> indxL.flat]</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    apparatusAngles=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a2533afa952ea007cfad4a1deb6a607a5">getAnglesFromRSpec</a>(rSpec, numReps=len(seqStartTimes+1))/180.*pi</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    theta=hstack(array(thPtsL) +apparatusAngles.ravel()[:len(thPtsL)]) <span class="comment">#angle of apparatus with respect to the cosmos</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    sig=real(S1cosmos*exp(-1j*theta) + S2cosmos*exp(-1j*2*theta))</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">#sig= amp*sin(theta + phi) + amp2*sin(2*theta + phi2)#Base signal</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">#Random outlier additions:</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    sig+=hstack([zeros(inds.shape) <span class="keywordflow">if</span> rand()&gt;fracDev <span class="keywordflow">else</span> sizeDev*ones(inds.shape) <span class="keywordflow">for</span> inds <span class="keywordflow">in</span> indxL.flat ])</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">#Uniform noise</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    sd=hstack(tPtsL)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    sig+= fast_noiseF(sd)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">#Repetitive noise</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">if</span> fastAddF <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        addN=hstack([fastAddF(<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aca5c571c3ee666190d0568fbcd72f1a9">sd2secs</a>(tPts-tPts[0])) <span class="keywordflow">for</span> tPts <span class="keywordflow">in</span> tPtsL ])</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        sig+=addN</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="comment">#sig[ind]+=fastAddF(sd[ind]-sd[ind[0]])</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> bTest:</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        figure(<span class="stringliteral">&#39;TestMakeTestData&#39;</span>)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        ax=subplot(311)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        plot(sd, sig,<span class="stringliteral">&#39;,&#39;</span>)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        subplot(312, sharex=ax)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        plot(trigs.flatten(), apparatusAngles.flatten(),<span class="stringliteral">&#39;-o&#39;</span>)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        subplot(313)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        plot(trigs.flatten(),<span class="stringliteral">&#39;o&#39;</span>)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">return</span> sd, sig<span class="comment">#SPDataSet(&#39;test&#39;, preloadDict={&#39;fastD&#39;:[sd, sig, [&#39;sig&#39;]]}, rSpec=rSpec)</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">#return SPDataSet(fastD=[sd, sig, [&#39;sig&#39;]])</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">  593</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">group_by_axis</a>(thetaIn):</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    theta=thetaIn[~isnan(thetaIn)]</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    absC=cos(theta)**2</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    absS=sin(theta)**2</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    sQ=mean(absS)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    cQ=mean(absC)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">#if any(theta%(2*pi)</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span> any( abs(theta%(pi) -pi/2) &lt;0.05 ) <span class="keywordflow">and</span> abs(0.5-sQ &lt;0.03) <span class="keywordflow">and</span> abs(0.5 -cQ) &lt;0.03: <span class="comment"># If we have a near-uniform sampling of angles...</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            thetaRef=0;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">else</span>: <span class="comment"># Otherwise we&#39;ll try to pick a good angle (This is not perfect by any  means)</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        thetaRef=arctan2(sQ, cQ);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        print(<span class="stringliteral">&quot;Data doesn&#39;t seem to be purely NS-&gt;EW. Setting main angle as {0} deg&quot;</span>.format(thetaRef/pi*180))</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    absC=abs(cos(thetaIn-thetaRef))</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    absS=abs(sin(thetaIn-thetaRef))</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    xI=where(absC&gt;0.99)[0] <span class="comment"># Points </span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    yI=where(absS&gt;0.99)[0] <span class="comment"># P</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> len(yI)&lt;4:</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        vprint(<span class="stringliteral">&quot;Not enough data points for orthogonal quadrature. Set yI =[]&quot;</span>)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        yI=[]</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">if</span> MT.nearby_angles(thetaRef, pi/2, 0.1):</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        xI,yI=yI,xI</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        thetaRef=0</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">return</span> thetaRef, xI, yI</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">#     &gt;&gt;&gt; N=100</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">#     &gt;&gt;&gt; th=linspace(0,20,N)%(2*pi)</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">#     &gt;&gt;&gt; sa= CorrelationData(linspace(0,1,N), sin(2*th), ones(N))</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00628"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a792112113be3784fc089059c6eed4ff1">  628</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a792112113be3784fc089059c6eed4ff1">rotate_sequence_amps</a>(seqAmp, rotateTo=0):</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    rotAmp=deepcopy(seqAmp)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">for</span> h <span class="keywordflow">in</span> range(rotAmp.sig.shape[1]):</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="comment">#newThetas, newSig, newErr=zip(*[th, s, er for th, s, er in zip(sig.theta[:,h], sig.sig[:,h], sig.err[:,h])])</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        zipped=zip(seqAmp.theta[:,h], seqAmp.sig[:,h], seqAmp.err[:,h]) </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        rotAmp.theta[:,h], rotAmp.sig[:,h], rotAmp.err[:,h]=zip(*[MT.rotate_quadrature_sample(th*(h+1), s, er,</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        rotateTo=rotateTo, debug=<span class="keyword">True</span>) <span class="keywordflow">if</span> <span class="keywordflow">not</span> all(isnan(s)) <span class="keywordflow">else</span> (th, s, er) <span class="keywordflow">for</span> (th, s, er) <span class="keywordflow">in</span> zipped])</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        rotAmp.theta[:,h]/=(h+1)</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">return</span> rotAmp</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">#  </span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00641"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aa986fff9d1f1b5354e43e972289e5844">  641</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aa986fff9d1f1b5354e43e972289e5844">process_sequences_multifit</a>(sig, sigSensL, sigSensVaryPhaseIs=[], subtractHarmsL=[], minFreq=None, maxFreq=None, bPlot=False, harmonic=1):</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    h=harmonic-1</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    varyPhaseIndL=[]</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">#sig=CorrelationData(*[c[:,h::h+1] for c in s]) for s in sig]</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">#sigSensL=[CorrelationData(*[c[:,h:] for c in s]) for s in sigSensL]</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    t=sig.t[:,h,0]</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">#_, sig1h, cov1h=MT.rotate_quadrature_sample(sig.theta[:,0,0], sig.sig[:,0], sig.err[:,0])</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    thetaRef, xI, yI=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">group_by_axis</a>(sig.theta)        </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    vprint(<span class="stringliteral">&quot;Main angle (for sidereal fit): {0}&quot;</span>.format(thetaRef))</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    sigRot=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a792112113be3784fc089059c6eed4ff1">rotate_sequence_amps</a>(sig, rotateTo=0)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    sigSensL=[<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a792112113be3784fc089059c6eed4ff1">rotate_sequence_amps</a>(sigSens, rotateTo=thetaRef) <span class="keywordflow">for</span> sigSens <span class="keywordflow">in</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    sigSensL]</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    yL=[sigSens.sig[:,h] <span class="keywordflow">for</span> sigSens <span class="keywordflow">in</span> sigSensL]</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">if</span> sigSensVaryPhaseIs:</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        varyPhaseIndL.extend(sigSensVaryPhaseIs)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        print(<span class="stringliteral">&quot;Allowing phase for sensors at {0} to vary&quot;</span>.format(sigSensVaryPhaseIs))</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    gdQuads=[]</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">for</span> k,th, s <span class="keywordflow">in</span> zip(arange(sigRot.theta.shape[2]), sigRot.theta[:,h,:].T, sigRot.sig[:,h,:].T):</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        notNan=th[~isnan(s)]</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">if</span> notNan.size:</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            gdQuads.append(k)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> all(MT.nearby_angles(notNan, notNan.min(), 0.1)):</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                vprint(<span class="stringliteral">&quot;Not all angles the same: maybe they&#39;re orthogonal?&quot;</span>)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">#yL.append(vstack([sin(2*pi*t+sig.theta[:,0]), cos(2*pi*t + sig.theta[:,0])]).T)</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">#Lab frame signal</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    dc=ones(t.size, dtype=<span class="stringliteral">&#39;f8&#39;</span>)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    yL.append(vstack([dc, dc*0]).T)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    varyPhaseIndL.append(len(yL)-1)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="comment"># Sidereal</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    refThetas=sigRot.theta.copy()</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">if</span> len(gdQuads)==1:</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">if</span> 0 <span class="keywordflow">in</span> gdQuads:</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            refThetas[:,h,1]=refThetas[:,h,0]+pi/2/harmonic</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            refThetas[:,h,0]=refThetas[:,h,1]-pi/2/harmonic</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    yL.append(1*cos(2*harmonic*pi*t[:,newaxis]+harmonic*refThetas[:,h]))</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    varyPhaseIndL.append(len(yL)-1)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="comment">#Add the 3rd harmonic ot the list(if it&#39;s there), and let it vary phase</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">for</span> harm <span class="keywordflow">in</span> subtractHarmsL:</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="keywordflow">if</span> sigRot.sig.shape[1]&gt;=harm:</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <span class="comment">#_, sigH, covH=MT.rotate_quadrature_sample(sig.theta, sig.sig[:,h-1], sig.err[:,h-1])</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            yL.append(sigRot.sig[:,harm-1])</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            varyPhaseIndL.append(len(yL)-1)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            print(<span class="stringliteral">&quot;{}th harmonic doesn&#39;t exist, can&#39;t subtract it&quot;</span>)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="comment">#nanIs=isnan(sigRot.sig[:,0])</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    sig2fit=sig</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    fitparams, cov, adjchi2, res_obj=MF.orthogonal_multifit(t, sigRot.sig[:,h], yL,varyPhaseIndL, var=sigRot.err[:,h],  minFreq=minFreq, maxFreq=maxFreq, bPlot=bPlot, bReturnFitObj=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    Nsensors=len(sigSensL)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    sensCoeffs=array(fitparams[:Nsensors])</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    labCoeffs=array(fitparams[Nsensors:Nsensors+2])<span class="comment">#-thetaRef</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    labCov=cov[Nsensors:Nsensors+2, Nsensors:Nsensors+2]</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    sidCoeffs=array(fitparams[Nsensors+2:Nsensors+4])<span class="comment">#-thetaRef</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    sidCov=cov[Nsensors+2:Nsensors+4, Nsensors+2:Nsensors+4]</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    sidAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a8dd105859db0f7ebef805efb3c08dfb7">SiderealFitData</a>(t=nanmean(t), sig=sidCoeffs, err=sidCov, </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            chi2=adjchi2, </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            labTheta=array([0,pi/2]),<span class="comment">#0*nanmean(-sigRot.theta[:,0], axis=0) ,</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            sidTheta=<span class="keywordtype">None</span>,</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            meta=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    labAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98ebdcd3ceb3fa1b7bc74e8caf64b50d">LabSetData</a>(t=nanmean(t), sig=labCoeffs, err=labCov, chi2=<span class="keywordtype">None</span>, labTheta=array([0.,pi/2]))</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="comment">#print(&quot;subtract fit params: {0}&quot;.format(res_obj.params))</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment"># Convert data types down here</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">#sigSubtracted=sig._replace(sig=(sig.sig.ravel()-sensCoeffs*array(sigSensL)).reshape(sig.sig.shape))</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">return</span> labAmp, sidAmp, <span class="keywordtype">None</span>, res_obj</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">#  </span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00720"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae33ce81936d04fd605560ec75ffe4a12">  720</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae33ce81936d04fd605560ec75ffe4a12">subtract_correlations</a>(sig, sigSensL, dontSubtract=[], scaleFact=None, minFreq=0.00005, maxFreq=None, bPlot=False):</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="comment"># Interpolate sigSensor to be the same as sig (if necessary))</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    sigSensL=[interp(sig.t.ravel(), sigSens.t.ravel(), sigSens.sig.ravel()) <span class="keywordflow">for</span> sigSens <span class="keywordflow">in</span> sigSensL]</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    sigSig=MT.naninterp(sig.sig.ravel())</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    sigSensL=[MT.naninterp(sigSens) <span class="keywordflow">for</span> sigSens <span class="keywordflow">in</span> sigSensL]</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">if</span> minFreq <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> maxFreq <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: <span class="comment">#Filter</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        fs=1/median(diff(MT.nonnan(sig.t.ravel())))/(3600*24)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordflow">if</span> minFreq <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> maxFreq <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            sigFilt=MF.butter_bandpass_filter(sigSig, [minFreq, maxFreq], fs)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            sigSensL=[MF.butter_bandpass_filter(sigSens, [minFreq, maxFreq], fs) <span class="keywordflow">for</span> sigSens <span class="keywordflow">in</span> sigSensL]</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="keywordflow">elif</span> maxFreq <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            sigFilt=MF.butter_lowpass_filter(sigSig, maxFreq, fs)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            sigSensL=[MF.butter_lowpass_filter(sigSens, maxFreq, fs) <span class="keywordflow">for</span> sigSens <span class="keywordflow">in</span> sigSensL]</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">elif</span> minFreq <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            sigFilt=MF.butter_highpass_filter(sigSig, minFreq, fs)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            sigSensL=[MF.butter_highpass_filter(sigSens, minFreq, fs) <span class="keywordflow">for</span> sigSens <span class="keywordflow">in</span> sigSensL]</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        sigFilt=sigSig</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="comment">#sigSensL=sigSensL</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="comment"># if @scaleFact is None, try to do a least-squares fit (or maybe something else in the longer-term)</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordflow">if</span> scaleFact <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        t=MT.naninterp(sig.t.ravel())</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">if</span> hasattr(sig,<span class="stringliteral">&#39;theta&#39;</span>):</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            theta=sig.theta</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">elif</span> hasattr(sig, <span class="stringliteral">&#39;labTheta&#39;</span>):</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            theta=sig.labTheta</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            theta=<span class="keywordtype">None</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">if</span> theta <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            theta=MT.naninterp(theta)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        dontSubtractD={ <span class="comment">#Make these lambda functions so we won&#39;t evaluate them unless necessary</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                <span class="stringliteral">&#39;lab_sinusoid&#39;</span>: <span class="keyword">lambda</span>: array((sin(theta), cos(theta))),</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                <span class="stringliteral">&#39;sid_sinusoid&#39;</span>: <span class="keyword">lambda</span>: array((sin(2*pi*t+theta), cos(2*pi*t+theta)))</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        exog=array(sigSensL).T</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">for</span> st <span class="keywordflow">in</span> dontSubtract: <span class="comment">#Elements should either be functions (of t) or strings </span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            arr=dontSubtractD[st]()</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            exog=hstack([exog,arr.T])</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        endog=sigFilt</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        exog=sm.add_constant(exog,prepend=<span class="keyword">False</span>)</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        model=sm.WLS(endog, exog, missing=<span class="stringliteral">&#39;drop&#39;</span>) <span class="comment">#(?)</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        res=model.fit()</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        scaleFact=array(res.params[:len(sigSensL)])</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        print(<span class="stringliteral">&quot;subtract fit params: {0}&quot;</span>.format(res.params))</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    sigSubtracted=sig._replace(sig=(sig.sig.ravel()-scaleFact*array(sigSensL)).reshape(sig.sig.shape))</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">if</span> bPlot <span class="keywordflow">or</span> 1:</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        figure()</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        plot(t, sigFilt, <span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        plot(t, exog, <span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        plot(t, (scaleFact*array(sigSensL)).T)</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">return</span> sigSubtracted</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aa45dbb6291e4944f3ba2718a3d0ee001">  779</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aa45dbb6291e4944f3ba2718a3d0ee001">preprocess_raw</a>(rawAmp, trigTimes, sigWindow):</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">#vprint(&quot;using {0}&quot;.format(sigWindow))</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    indxL= <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a87aac33304db20fd58d7a3625061cca6">sliceSorted</a>(rawAmp.t, t_0=trigTimes + <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(sigWindow.offset),  delta_t=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(sigWindow.duration)) <span class="comment">#indices of the points between each rotation</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">#Now we &#39;regularize&#39; it, making sure there&#39;s the same number of points in each slice (needed to make things faster later)</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    NptsL=[ind.size <span class="keywordflow">for</span> ind <span class="keywordflow">in</span> indxL.ravel() <span class="keywordflow">if</span> ind.size&gt;1] <span class="comment">#2 pts may be the minimum we can work with?</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    minPtsI=argmin(NptsL)</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    maxPts=max(NptsL)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    k=0;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">while</span> NptsL[minPtsI]&lt; 0.9*maxPts:</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        vprint(<span class="stringliteral">&quot;A cut was too short: {0} vs {1}&quot;</span>.format(NptsL[minPtsI], maxPts)) </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        NptsL.pop(minPtsI)</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        minPtsI=argmin(NptsL)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        k+=1;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">if</span> k&gt;=20:</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            print(<span class="stringliteral">&quot;Too mny short cuts. There&#39;s probably a segment of bad data&quot;</span>)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="comment">#raise ValueError(&quot;Too mny short cuts. There&#39;s probably a segment of bad data&quot;)</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    minPts=NptsL[minPtsI]</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    indxLReg=array([ind[:minPts] <span class="keywordflow">if</span> ind.size&gt;=minPts <span class="keywordflow">else</span> -1*ones(minPts,dtype=<span class="stringliteral">&#39;i8&#39;</span>) <span class="keywordflow">for</span> ind <span class="keywordflow">in</span> indxL.ravel()])</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    indxLReg=indxLReg.reshape(indxL.shape[0], indxL.shape[1], minPts)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    rawAmpOut=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a29a04cecefb141502380f4e43bc1d06d">RawData</a>(t= rawAmp.t[indxLReg], sig=rawAmp.sig[indxLReg])</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    rawAmpOut.sig[indxLReg==-1]=nan</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    rawAmpOut.t[indxLReg==-1]=nan</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">return</span> rawAmpOut</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    </div>
<div class="line"><a name="l00808"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5d91f2e7930fdc007f010659068307f9">  808</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5d91f2e7930fdc007f010659068307f9">process_raw</a>(rawAmp):</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keyword">def </span>window_mean(arr, axis=0):</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        win=windows.kaiser(arr.shape[axis], 10)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        win/=win.sum()</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="comment">#This isn&#39;t right</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">return</span> sum(arr*win[newaxis,newaxis,:],axis=axis)</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    funcs_on_cutsL=[np.mean, <span class="keyword">lambda</span> vals, **kwargs: np.std(vals, **kwargs)/sqrt(np.size(vals))]</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    T=rawAmp.t.mean(axis=-1)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    Y=window_mean(rawAmp.sig, axis=-1) </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    Err=np.std(rawAmp.sig,axis=-1)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">#Y, Err= processedL[0:]</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="comment">#rawSig=array([y[ind[:minPts]] if ind.size&gt;=minPts else zeros(minPts)*nan for ind in indxL.ravel()])</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="comment">#rawSig=rawSig.reshape(indxL.shape[0], indxL.shape[1], minPts)</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="comment">#rawSigF=fft(rawSig)</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">return</span>  <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a1ffb0a48d6d36a1260a65e82c4604ce2">PointData</a>(t=T, sig=Y, err=Err,chi2=<span class="keywordtype">None</span>,theta=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">#  Turn groups of points into sequences- except currently we go directly from a a group of &#39;cuts&#39; (i.e. the cut-out raw data) to one value for each sequences.</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00829"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7265a1148ca13e5fb7961b297a214d13">  829</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7265a1148ca13e5fb7961b297a214d13">process_points</a>(ptLabAngle, pointAmp, cutAmp, stPtChi2Lim=50):</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    vprint(<span class="stringliteral">&quot;chi2 limit on string points: {}&quot;</span>.format(stPtChi2Lim))</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    pointAmp=<span class="keywordtype">None</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    ptT=mean(cutAmp.t, axis=-1)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    ptErr=std(cutAmp.sig, axis=-1)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> ptLabAngle.shape[0] &gt; cutAmp.sig.shape[0]:</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">if</span> ptLabAngle.shape[0]==cutAmp.sig.shape[0]+1:</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            ptLabAngle=ptLabAngle[:-1]</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;angles shouldn&#39;t be more than 1 sequence bigger than the dataset (can happen if only part of a sequence is included). But here, ptLabAngle.shape[0] is {0} and cutAmp.shape[0] is {1}&quot;</span>.format(ptLabAngle.shape[0], cutAmp.sig.shape[0]))</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment"># Process each group of sequences</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    outL=zip(*[<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a154be474c56db17750f8232efe410d54">mgStringHarmonics</a>(th, seq, <span class="keywordtype">None</span>, chi2Filter=inf) <span class="keywordflow">for</span> th,seq, err <span class="keywordflow">in</span> zip(ptLabAngle, cutAmp.sig, ptErr)])</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">if</span> stPtChi2Lim <span class="keywordflow">is</span> <span class="keywordflow">not</span> inf:</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="comment">#origSigA=array(outL[1])</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        chi2temp=nanmean(array(outL[3]), axis =-1).squeeze()</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        smoothedChi2=MT.running_nanmedian(chi2temp, 100)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        outL=zip(*[<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a154be474c56db17750f8232efe410d54">mgStringHarmonics</a>(th, seq, <span class="keywordtype">None</span>, chi2Filter=stPtChi2Lim*smChi2) <span class="keywordflow">for</span> th,seq, err, smChi2 <span class="keywordflow">in</span> zip(ptLabAngle, cutAmp.sig, ptErr, smoothedChi2)])</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    labAngle, seqSig, seqErr, seqChi2 = [array(p) <span class="keywordflow">for</span> p <span class="keywordflow">in</span> outL] <span class="comment">#Array-ify the results</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="comment">#Old stuff for doing harmonicsFit</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="comment">#th0s,h1,cov1=zip(*[getHarmonicsFit(th, seq, err) for th,seq, err in zip(theta[:-1], ptSig, ptErr )])</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="comment">#h1=array(h1)</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">#cov1=array(cov1)</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="comment">#covAs=cov1[:,0].squeeze()</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="comment">#th0s=array(th0s)</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">#chi2=None  </span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    seqT=nanmean(ptT, axis=1)</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    seqT=seqT[:,newaxis, newaxis]*ones(seqSig.shape) <span class="comment">#make T&#39;s the same shape as the rest</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">CorrelationData</a>(t=seqT, sig=seqSig, err=seqErr, chi2=seqChi2, theta=labAngle)</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div>
<div class="line"><a name="l00861"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aefa37b595edec764011c69c3202787f6">  861</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aefa37b595edec764011c69c3202787f6">filterBySensors</a>(cutAmp, sensDataL=[], bView=True):</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="comment">#bView=True</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> sensDataL:</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        vprint(<span class="stringliteral">&quot;No sensor filtering&quot;</span>)</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">return</span> cutAmp</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    Npts=cutAmp.sig.size/(cutAmp.sig.shape[-1])</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    badM=zeros(Npts, dtype=bool) <span class="comment">#Mask for &#39;bad&#39; data</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span> bView:</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        fig, axL=subplots(len(sensDataL)+1, 1, sharex=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="comment">#vprint(&quot;Filtering out bad points using sensors {0}&quot;.format(sensorNameL))</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keywordflow">for</span> k, sD <span class="keywordflow">in</span> enumerate(sensDataL):</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="comment">#sDTs, [_, sDCutSig, sDCutErr], sDCutIndxL = sliceReduceData( sD[0], sD[1], trigTimes + secs2sd(sigWindow.offset), secs2sd(sigWindow.duration) ) </span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        badSDM, xSM=MT.findOutliers(sD.sig.ravel(), windowLen=70, sigmas=3, bReturnMeanLine=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        badM= badM | badSDM</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordflow">if</span> bView:</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            axL[k+1].plot(sD.t.ravel(), sD.sig.ravel(),<span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            axL[k+1].plot(sD.t.ravel()[badSDM], sD.sig.ravel()[badSDM],<span class="stringliteral">&#39;o&#39;</span>)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <span class="comment">#axL[k+1].plot(sDTs.ravel()[badSDM], sDCutSig.ravel()[badSDM],&#39;o&#39;)</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> bView:</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        sigA=cutAmp.sig.mean(axis=-1)</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        axL[0].plot(sD.t.ravel(), sigA.ravel(),<span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        axL[0].plot(sD.t.ravel()[badM], sigA.ravel()[badM],<span class="stringliteral">&#39;.&#39;</span>) </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    filtCutAmp=cutAmp._replace(sig=cutAmp.sig.copy())</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    filtCutAmp.sig.reshape(-1,filtCutAmp.sig.shape[-1])[badM]=nan</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">return</span> filtCutAmp</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">#def process_sequences(sT, sSig, sErr, sLabAngles):</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment"># Process sequence values, sSig, into final numbers</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l00895"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98d08fa254a21b0b0895f424f7006dbd">  895</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98d08fa254a21b0b0895f424f7006dbd">process_sequences</a>(corrAmp):</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    sT,sSig, sErr, sChi2, sLabAngles=[s[:,0,:] <span class="keywordflow">for</span> s <span class="keywordflow">in</span> corrAmp]</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">if</span> sSig.size==0:</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="comment">#sErr*sqrt(sChi2)</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="comment">#winI=20</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="comment">#chi2=nanmedian(corrAmp.chi2[I]*(corrAmp.Neff[I]./stats.chi2.ppf(0.5, corrAmp.Neff)), axis=0) </span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="comment">#chisq1=nanmedian(v1(w,3,:).*(v1(w,4,:)./chi2inv(.5,v1(w,4,:))),1);</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="comment">#v1(j,2,:)=v1(j,2,:).*sqrt(chisq1);</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> iterable(sLabAngles) <span class="keywordflow">or</span> len(sLabAngles)==1 <span class="keywordflow">or</span> unwrap(sLabAngles%pi).sum()&lt;pi:<span class="comment">#(maaaaaybeee)</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        vprint(<span class="stringliteral">&quot;no lab angles given for sequence data in &#39;process_sequences&#39;. Doing something dodgy that probably isn&#39;t right to make up for it&quot;</span>)</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">if</span> sSig:</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            labSig= average(sSig, weights=sErr**2)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            labSig=[];labErr=[];labAngles=[]</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        labAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98ebdcd3ceb3fa1b7bc74e8caf64b50d">LabSetData</a>(t=mean(sT), sig=labSig, err=<span class="keywordtype">None</span>, chi2=<span class="keywordtype">None</span>, labTheta=squeeze(labAngles))</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="keywordflow">if</span> sErr.ndim&gt;2:</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            sErr=vstack([sErr[:,0,0], sErr[:,1,1]]).T</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        [labAngles, labSignal, labErr, labChi2]=zip(*<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7590e0785adc48ccbabea8d0eccda514">getHarmonicsFit</a>(sLabAngles, sSig, sErr))[0] <span class="comment">#This returns two angles, and we&#39;ll limit ourselves to the first harmonic</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        labAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98ebdcd3ceb3fa1b7bc74e8caf64b50d">LabSetData</a>(t=mean(sT)*ones(len(labAngles)),</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                sig=array(labSignal), </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                err=sqrt(diag(labErr)),</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                chi2=labChi2,</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                labTheta=array(labAngles))</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="comment">#labAmp=[array(labAmpTemp[0]), array(labAmpTemp[1]), sqrt(diag(labAmpTemp[2]))]</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="comment">######SIDEREAL-FRAME FITTING##########</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="comment">#LV0=zip(*getHarmonicsFit(sT*2*pi, sSig, sErr))[0] #First harmonic only</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordflow">if</span> sLabAngles <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        print(<span class="stringliteral">&quot;Not checked if it works when you don&#39;t give lab angles for sequences... we&#39;ll presume all measuremetns are taken in the same lab-orientation, but beware!&quot;</span>)</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        [sidAngles, sidSignal, sidErr, sidChi2]=zip(*<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7590e0785adc48ccbabea8d0eccda514">getHarmonicsFit</a>(sT*2*pi, sSig, sErr))[0]</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        [sidAngles, sidSignal, sidErr, sidChi2]=zip(*<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7590e0785adc48ccbabea8d0eccda514">getHarmonicsFit</a>(sT*2*pi + sLabAngles, sSig, sErr))[0]</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    sidFitDat=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a8dd105859db0f7ebef805efb3c08dfb7">SiderealFitData</a>(t=mean(sT)*ones(len(labAngles)),</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                    <span class="comment">#sig=array(sidSignal), err=sqrt(diag(sidErr)),</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                    sig=array(sidSignal), err=sidErr,</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                    labTheta=array(sidAngles), chi2=sidChi2, sidTheta=<span class="keywordtype">None</span>, meta=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="comment">#Repeat this for lab angles, and other sideral angles</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="comment">#sidAmp=[array(sidAmpTemp[0]), array(sidAmpTemp[1]), sqrt(diag(sidAmpTemp[2]))]</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">return</span> labAmp, sidFitDat</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9ae89d50fa931a7cc863400505be38b1">  939</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9ae89d50fa931a7cc863400505be38b1">process_continuous_raw</a>(sigRaw, phaseRef, rotationRate, bPlot=False, th0FGz=2.87):</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="comment">#split up data</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="comment">#iterate through data</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="comment">#if phaseRef is a rawSig tuple (e.g. flux-gate), then fit it</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">#else we&#39;ll assume it&#39;s time-theta pairs, in which case we&#39;ll also just interpolate </span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="comment">#Fit the raw signal to a sin/cos pair plus some polynomial terms</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    tOffs=sigRaw.t[0]</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="comment">#K=3600*24</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    tSplit, sSplit = MT.splitAtGaps(<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aca5c571c3ee666190d0568fbcd72f1a9">sd2secs</a>(sigRaw.t-tOffs), sigRaw.sig)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    tMedSplit, fgSplit = MT.splitAtGaps(<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aca5c571c3ee666190d0568fbcd72f1a9">sd2secs</a>(phaseRef.t-tOffs), phaseRef.sig)</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    gdInds=[~isnan(s) <span class="keywordflow">for</span> s <span class="keywordflow">in</span> sSplit]</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    tSplit=[t[gdI] <span class="keywordflow">for</span> t, gdI <span class="keywordflow">in</span> zip(tSplit, gdInds)]</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    sSplit=[s[gdI] <span class="keywordflow">for</span> s, gdI <span class="keywordflow">in</span> zip(sSplit, gdInds)]</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">#plot(sig.t, MT.smooth(sig.sig,500, window=&#39;hanning&#39;))</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    fp4L=[]</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    err4L=[]</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    chi2L=[]</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    tL=[]</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    fgFitL=[]</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    phaseL=[]</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    thL=[]</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    k=0</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">for</span> t, s, tfg, sfg <span class="keywordflow">in</span> zip(tSplit, sSplit, tMedSplit, fgSplit):</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">if</span> t.size&lt;2:</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        midT=t[t.size/2]</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        cutOffSecs=0</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        t-=midT</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        I=t.searchsorted(t[-1]-cutOffSecs)</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        t=t[:I]</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        s=s[:I]</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        tfg-=midT</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        I=tfg.searchsorted(tfg[-1]-cutOffSecs)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        tfg=tfg[:I]</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        sfg=sfg[:I]</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            p0=[ rotationRate,  0.03262361,  0.03052155,  5.41955202]</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            gdI=~isnan(sfg)</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            fFG=<span class="keyword">lambda</span> t, f, a1, a2, offs: a1*sin(2*pi*f*t) + a2*cos(2*pi*f*t) + offs</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            fpFG, err=curve_fit(fFG, tfg[gdI], sfg[gdI],p0=p0)</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            fgFitL.append(fpFG)</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="comment">#figure()</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <span class="comment">#plot(tfg,sfg)</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            <span class="comment">#plot(tfg, fFG(tfg, *fpFG))</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            <span class="comment">#figure()</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            <span class="comment">#plot(tfg, MT.smooth(sfg-fFG(tfg, *fpFG), 10))</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            th0=arctan2(fpFG[1], fpFG[2]) <span class="comment"># The angle where the fluxgate shows a minimum deviationF</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            phaseL.append(th0)</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            thfg=2*pi*fpFG[0]*tfg-th0%(2*pi)-2*pi</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="comment">#thfg=2*pi*(fpFG[0]-0.005)*tfg-th0%(2*pi)-2*pi</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            th=interp(t, tfg,thfg)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            f4=<span class="keyword">lambda</span> th, a1x, a1y, a2x, a2y, a3x,a3y, p1, p2, p3, p4, p5, offs: a1x*sin(th) + a1y*cos(th) + a2x*sin(2*th) + a2y*cos(2*th)+ a3x*sin(3*th) + a3y*cos(3*th)+ p1*th +p2*th**2 + p3*th**3 + p4*th**4 + p5*th**5 + offs</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            p0=[0.1, 0.1, 1e-5, 1e-7, 1e-9, 0.08]</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            sampleRate=1./median(diff(t))</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <span class="comment">#print(&quot;Sample rate is {}&quot;.format(sampleRate))</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            Nds=round(sampleRate)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            p0=[0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 1e-5, 1e-7, 1e-9, 1e-9, 1e-9, 0.08]</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            th_ds, s_ds=MT.downsample_npts(th,Nds), MT.downsample_npts(s, Nds)</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="keywordflow">if</span> th_ds.size &lt;= len(p0) +1:</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&quot;not enough data here&quot;</span>)</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            fp4, err4=curve_fit(f4, th_ds, s_ds, p0=p0)</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            chi2= sum((f4(th, *fp4)-s)**2)/(th.size-len(p0))</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;            <span class="comment">#fp, err=curve_fit(f, th,s,p0=p0)</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <span class="comment">#fp2, err2=curve_fit(f2, th, s,p0=p0)</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <span class="comment">#figure()</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <span class="comment">#plot(t,MT.smooth(s,Nds, window=&#39;hanning&#39;))</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            <span class="comment">#plot(t, f(th, *fp))</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            <span class="comment">#plot(t, f2(th, *fp2))</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;            <span class="comment">#print(&quot;fp4: {0}&quot;.format(fp4))</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            fp4L.append(fp4)</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            chi2L.append(chi2)</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;            <span class="comment">#err4L.append(sqrt(diag(err4)))</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            err4L.append(err4)</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            tL.append(midT)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            thL.append(th)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keywordflow">except</span> RuntimeError:</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            print(<span class="stringliteral">&quot;No fit at {}&quot;</span>.format(midT))</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    fp4A=array(fp4L)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    fpA=fp4A[:,:2]</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    fp2A=fp4A[:,2:4]</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    fp3A=fp4A[:,4:6]</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    err4A=array(err4L)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    errA=err4A[:,:2,:2]</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    err2A=err4A[:,2:4,2:4]</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    err3A=err4A[:,4:6,4:6]</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    chi2A=array(chi2L)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    tA=array(tL)</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordflow">if</span> bPlot:</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        figure()</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        errorbar(tA, fpA[:,0], errA[:,0],fmt=<span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        errorbar(tA, fpA[:,1], errA[:,1],fmt=<span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        title(<span class="stringliteral">&quot;1st harmonic&quot;</span>)</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        figure()</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        errorbar(tA, fp2A[:,0], err2A[:,0],fmt=<span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        errorbar(tA, fp2A[:,1], err2A[:,1],fmt=<span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        title(<span class="stringliteral">&#39;2nd Harmonic&#39;</span>)</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        figure()</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        plot(tA, [p[0] <span class="keywordflow">for</span> p <span class="keywordflow">in</span> fgFitL])</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        figure()</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        plot(tA, [p[1] <span class="keywordflow">for</span> p <span class="keywordflow">in</span> fgFitL])</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        plot(tA, [p[2] <span class="keywordflow">for</span> p <span class="keywordflow">in</span> fgFitL])</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        figure()</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        plot(tA, phaseL)</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    N=tA.size</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    tSeq=tile(<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(tA)+tOffs, [2,2,1]).T</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    sigSeq=hstack( [fpA[:,newaxis, :2], fp2A[:,newaxis,:2], fp3A[:,newaxis,:2]] )</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    errSeq=hstack( [errA[:,newaxis, :2], err2A[:,newaxis,:2], err3A[:, newaxis,:2]] )</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">#chi2Seq=hstack( [chi2_1A[:,newaxis], chi2_2A[:,newaxis]] )</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    chi2Seq=hstack( [chi2A[:,newaxis], chi2A[:,newaxis], chi2A[:,newaxis]] )</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    chi2Seq=dstack([chi2Seq, chi2Seq])</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    sgn=-1 <span class="keywordflow">if</span> rotationRate&lt;0 <span class="keywordflow">else</span> 1</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    thetaSeq1=vstack( [zeros(N), zeros(N), zeros(N)])</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="comment">#thetaSeq2=vstack( [sgn*ones(N)*pi/2, sgn*ones(N)*pi/4, sgn*ones(N)*pi/6] )</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    thetaSeq2=vstack( [sgn*ones(N)*pi/2, sgn*ones(N)*pi/2, sgn*ones(N)*pi/2] )</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">#thetaSeq1=vstack( [zeros(N), ones(N)*pi/2])</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="comment">#thetaSeq2=vstack( [zeros(N), ones(N)*pi/4])</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="comment">#thetaSeq2=vstack( [ones(N)*pi/2, ones(N)*pi/4])</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    thetaSeq=dstack([thetaSeq1.T, thetaSeq2.T])</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    seqAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">CorrelationData</a>(</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            t=tSeq.copy(),</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            sig=sigSeq.copy(),</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            err=errSeq.copy(),</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            chi2=chi2Seq.copy(),</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            theta=thetaSeq.copy() + th0FGz, <span class="comment">#th0FGz is the orientation of the FGz correlation</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            )</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">return</span> seqAmp</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae43119e40ee34e8e5f67a1088548adb6"> 1089</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae43119e40ee34e8e5f67a1088548adb6">split_and_process_sequences</a>(seqAmp):</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    seqT, seqSig, seqErr, seqChi2, labAngle=seqAmp</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keyword">def </span>seqFiltAngle(seqAmp, th):</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        mask=nearby_angles(seqAmp.theta[:,0,0], th, 0.1)</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">CorrelationData</a>(*[s[mask] <span class="keywordflow">for</span> s <span class="keywordflow">in</span> seqAmp])</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    seqAmp1=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">CorrelationData</a>(seqAmp.t, *[d[:,0,0].squeeze() <span class="keywordflow">for</span> d <span class="keywordflow">in</span> seqAmp[1:]])</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    seqAmp2=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">CorrelationData</a>(seqAmp.t, *[d[:,0,1].squeeze() <span class="keywordflow">for</span> d <span class="keywordflow">in</span> seqAmp[1:]])</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    thetaRef, xI, yI=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">group_by_axis</a>(seqAmp1.theta)        </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    seqAmp1_0=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">CorrelationData</a>(*[d[xI] <span class="keywordflow">for</span> d <span class="keywordflow">in</span> seqAmp1])</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    seqAmp1_90=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">CorrelationData</a>(*[d[yI] <span class="keywordflow">for</span> d <span class="keywordflow">in</span> seqAmp1])</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">#seqAmp1_0=seqAmp1_0._replace(theta= seqAmp1_0.theta*sin(seqAmp1.theta[xI]-thetaRef))</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="comment">#seqAmp1_90=seqAmp1_90._replace(theta=seqAmp1_90.theta*cos(seqAmp1.theta[yI]-thetaRef))</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="comment">#seqSig1_0=seqSig1[xI]*sin(labAngle1[xI]-thetaRef)</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="comment">#seqErr1_0=seqErr1[xI]</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="comment">#seqSig1_90=seqSig1[yI]*cos(labAngle1[yI]-thetaRef)</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="comment">#seqErr1_90=seqErr1[yI]</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="comment">#seqT_0=seqT[xI]</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="comment">#seqT_90=seqT[yI]</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="comment">#seqAmp_0=CorrelationData([d[xI] for d in </span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="comment">#seqAmp_0CorrelationData(t=seqT_0, sig=seqSig1_0, err=seqErr1_0, chi2=seqChi21[xI], labTheta=labAngle1[xI], None)</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    seqAmpL=(seqAmp1_0, seqAmp1_90, seqAmp1)</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    ampL=[ <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98d08fa254a21b0b0895f424f7006dbd">process_sequences</a>(sAmp) <span class="keywordflow">for</span> sAmp <span class="keywordflow">in</span> seqAmpL   ]</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="comment">#labAmp1_0, sidAmp1_0=process_sequences(seqAmp1_0)</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="comment">#labAmp1_90, sidAmp1_90=process_sequences(seqAmp1_90)</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="comment">#labAmp, sidAmp=process_sequences(seqAmp1)</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="comment">#labAmp0, sidAmp0=process_sequences(seqT_0, seqSig1_0, seqErr1_0, thetaRef)</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="comment">#labAmp90, sidAmp90=process_sequences(seqT_90, seqSig1_90, seqErr1_90, thetaRef+pi/2)</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="comment">#labAmp, sidAmp=process_sequences(seqT, seqSig1, seqErr1, labAngle1)</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="comment">#labAmpAlt= [labAmp0, labAmp90]</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="comment">#NS, EW=average([sidAmp0[1], sidAmp90[1][::-1]], axis=0, weights=[sidAmp[2]**2, sidAmp90[2][::-1]])</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="comment">#NS_err, EW_err = sqrt(sidAmp0[2]**2 + sidAmp90[2][::-1]**2)/2.</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">#sidAmpAlt=[ (NS, EW), (NS_err, EW_err)] </span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    </div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <span class="keywordflow">return</span> zip(*ampL) + [seqAmpL] <span class="comment"># --&gt; (labAmps, sidAmps, seqAmps)</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="comment">#return [ (labAmp, labAmpAlt), (sidAmp, sidAmpAlt)]</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9c4d4bc9bf9302d2690f560af0d9982b"> 1135</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9c4d4bc9bf9302d2690f560af0d9982b">view_raw</a>(rawAmp0, cutAmpL, trigTimes, cutAmpLNames=None, figName=None):</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="keywordflow">if</span> figName <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        figDontReplace(figName + <span class="stringliteral">&#39; -raw&#39;</span>)</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        figDontReplace()</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    gs=GridSpec(2,3)</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    ax1=subplot(gs[0,:])</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    ax2=subplot(gs[1,0])</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    ax3=subplot(gs[1,1])</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    ax4=subplot(gs[1,2])</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    ax1.plot(rawAmp0.t, rawAmp0.sig)</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">for</span> cutAmp, name <span class="keywordflow">in</span> zip(cutAmpL, cutAmpLNames):</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        ax1.plot(cutAmp.t.ravel(), cutAmp.sig.ravel(), label=name, markersize=5)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">#ax1.vlines(trigTimes, rawAmp0.sig.min(), rawAmp0.sig.max(), linestyles=&#39;dotted&#39;)</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    ax1.set_title(<span class="stringliteral">&#39;raw signal&#39;</span>)</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    ax1.set_xlabel(<span class="stringliteral">&#39;sd&#39;</span>)</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    ax1.legend()</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="comment">#cutAmp.sigF=fft(cutAmp.sig- nanmean(cutAmp.sig, axis=-1)[:,:,newaxis])</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    cutAmpSigF, fax=MF.rPSD(cutAmp.sig- nanmean(cutAmp.sig, axis=-1)[:,:,newaxis], t=cutAmp.t[0][0])</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    ax2.plot(fax/3600/24, nanmean(nanmean(abs(cutAmpSigF), axis=0), axis=0))</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    ax2.set_title(<span class="stringliteral">&#39;PSD&#39;</span>)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    ax2.set_xlabel(<span class="stringliteral">&#39;Hz&#39;</span>)</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">if</span> 0:</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        ax3.hist(nonnan(nanstd(cutAmp.sig, axis=-1).ravel()), bins=30)</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        ax3.set_title(<span class="stringliteral">&#39;std&#39;</span>)</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        ttemp=cutAmp.t[0][0]</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        slopes=[polyfit(ttemp, y, 1)[0] <span class="keywordflow">for</span> y <span class="keywordflow">in</span> cutAmp.sig.reshape(-1, cutAmp.sig.shape[-1]) <span class="keywordflow">if</span> <span class="keywordflow">not</span> all(isnan(y))]</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        ax4.hist(nonnan(slopes), bins=30)</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        ax4.set_title(<span class="stringliteral">&#39;slopes&#39;</span>)</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div>
<div class="line"><a name="l01169"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af195e86c16fec9d60d1ac20dbe5d1f19"> 1169</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af195e86c16fec9d60d1ac20dbe5d1f19">view_correlation_filtering</a>(pointAmpInit, correlationAmpInit, pointAmpFilt, correlationAmpFilt, figName=None, sharexAx=None):</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">if</span> figName <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        figDontReplace()</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        figDontReplace(figName+<span class="stringliteral">&#39; -Corr diff&#39;</span>)</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    gs=GridSpec(3,1)</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    pointAxs=MT.plot_errorbar_and_hist(pointAmpInit.t.ravel(), pointAmpInit.sig.ravel(), pointAmpInit.err.ravel(), subplotSpec=gs[0], sharexs=[sharexAx,<span class="keywordtype">None</span>])</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    pointAxs=MT.plot_errorbar_and_hist(pointAmpFilt.t.ravel(), pointAmpFilt.sig.ravel(), </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            pointAmpFilt.err.ravel(), *pointAxs</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            )</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    thetaRef, xI, yI=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">group_by_axis</a>(correlationAmpInit.theta[:,0,:].ravel())        </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    corAxs=MT.plot_errorbar_and_hist(correlationAmpInit.t.ravel()[xI], </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            correlationAmpInit.sig.ravel()[xI]*sin(correlationAmpInit.theta.ravel()[xI]),</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            correlationAmpInit.err.ravel()[xI], subplotSpec=gs[1], sharexs=[pointAxs[0], <span class="keywordtype">None</span>]</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            )</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    MT.plot_errorbar_and_hist(correlationAmpInit.t.ravel()[yI], correlationAmpInit.sig.ravel()[yI]*cos(correlationAmpInit.theta.ravel()[yI]), correlationAmpInit.err.ravel()[yI], *corAxs)</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    thetaRef, xI, yI=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">group_by_axis</a>(correlationAmpFilt.theta[:,0,:].ravel())        </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    corAxs=MT.plot_errorbar_and_hist(correlationAmpFilt.t.ravel()[xI], </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            correlationAmpFilt.sig.ravel()[xI]*sin(correlationAmpFilt.theta.ravel()[xI]),</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            correlationAmpFilt.err.ravel()[xI], *corAxs</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            )</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    MT.plot_errorbar_and_hist(correlationAmpFilt.t.ravel()[yI], correlationAmpFilt.sig.ravel()[yI]*cos(correlationAmpFilt.theta.ravel()[yI]), correlationAmpFilt.err.ravel()[yI], *corAxs)</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    chi2Axs=MT.plot_scatter_and_hist(correlationAmpInit.t.ravel(), correlationAmpInit.chi2.ravel(), subplotSpec=gs[2], sharexs=[pointAxs[0],<span class="keywordtype">None</span>], scatD={<span class="stringliteral">&#39;c&#39;</span>:<span class="stringliteral">&#39;b&#39;</span>})</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    chi2Axs=MT.plot_scatter_and_hist(correlationAmpFilt.t.ravel(), correlationAmpFilt.chi2.ravel(), *chi2Axs, scatD={<span class="stringliteral">&#39;c&#39;</span>:<span class="stringliteral">&#39;g&#39;</span>})</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div>
<div class="line"><a name="l01198"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a45a8e352a69cc8a225a32134c87cd120"> 1198</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a45a8e352a69cc8a225a32134c87cd120">view_correlations</a>(pointAmp, correlationAmp, figName=None, sharexAx=None, correlationSigComp=None ):</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">if</span> figName <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        figDontReplace()</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        figDontReplace(figName+<span class="stringliteral">&#39; -Corr&#39;</span>)</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    gs=GridSpec(3,1)</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    gs=GridSpec(5,1)</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordflow">if</span> correlationSigComp <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> 1:</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <span class="comment">#refNonNanM=~isnan(correlationSigComp)</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        diffI=where( (correlationSigComp.ravel()!=correlationAmp.sig.ravel()) &amp; (~isnan(correlationSigComp.ravel())))[0]</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="comment">#diffMask=correlationSigComp[refNonNanM]!=correlationAmp.sig[refNonNanM]</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="comment">#diffI=arange(correlationSigComp.size)[refNonNanM][diffMask.ravel()]</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="comment">#diffAmp[diffAmp==0]=nan</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="comment">#diffMask=~isnan(diffAmp.ravel())</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="comment">#pdb.set_trace()</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    pointAxs=MT.plot_errorbar_and_hist(pointAmp.t.ravel(), pointAmp.sig.ravel(), pointAmp.err.ravel(), subplotSpec=gs[0], sharexs=[sharexAx,<span class="keywordtype">None</span>])</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    correlationAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a792112113be3784fc089059c6eed4ff1">rotate_sequence_amps</a>(correlationAmp)</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    thetaRef, xI, yI=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">group_by_axis</a>(correlationAmp.theta[:,0,:].ravel())        </div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    err1h=sqrt(vstack([correlationAmp.err[:,0,0,0],correlationAmp.err[:,0,1,1]]).T)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    corAxs=MT.plot_errorbar_and_hist(correlationAmp.t[:,0].ravel()[xI], </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        correlationAmp.sig[:,0].ravel()[xI]*cos(correlationAmp.theta[:,0].ravel()[xI]), </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        err1h.ravel()[xI], </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        subplotSpec=gs[1], sharexs=[pointAxs[0], <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    MT.plot_errorbar_and_hist(correlationAmp.t[:,0].ravel()[yI], correlationAmp.sig[:,0].ravel()[yI]*sin(correlationAmp.theta[:,0].ravel()[yI]), err1h.ravel()[yI], *corAxs)</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">if</span> correlationSigComp <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <span class="comment">#corAxs[0].plot(correlationAmp.t.ravel()[diffMask==xI], diffAmp.ravel()[diffMask==xI], &#39;rx&#39;)</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        xdI=intersect1d(xI, diffI)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        ydI=intersect1d(yI, diffI)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        corAxs[0].plot(correlationAmp.t.ravel()[xdI], correlationSigComp.ravel()[xdI]*cos(correlationAmp.theta[:,0].ravel()[xdI]), <span class="stringliteral">&#39;rx&#39;</span>)</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="comment">#corAxs[0].plot(correlationAmp.t.ravel()[diffMask==yI], diffAmp.ravel()[diffMask==yI], &#39;yx&#39;)</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        corAxs[0].plot(correlationAmp.t.ravel()[ydI], correlationSigComp.ravel()[ydI]*sin(correlationAmp.theta[:,0].ravel()[ydI]), <span class="stringliteral">&#39;yx&#39;</span>)</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    ax=subplot(gs[2])</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="comment">#ax.plot(correlationAmp.t[:,0].ravel()[yI], correlationAmp.chi2[:,0].ravel()[yI],&#39;o&#39;)</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="comment">#ax.plot(correlationAmp.t[:,0].ravel()[xI], correlationAmp.chi2[:,0].ravel()[xI],&#39;o&#39;)</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    chi21hAxs=MT.plot_scatter_and_hist(correlationAmp.t[:,0].ravel()[xI], correlationAmp.chi2[:,0].ravel()[xI], subplotSpec=gs[2])</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    MT.plot_scatter_and_hist(correlationAmp.t[:,0].ravel()[yI], correlationAmp.chi2[:,0].ravel()[yI], *chi21hAxs)</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <span class="keywordflow">if</span> correlationAmp.t.shape[1]&gt;1: <span class="comment">#2H</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        err2h=sqrt(vstack([correlationAmp.err[:,1,0,0],correlationAmp.err[:,1,1,1]]).T)</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        thetaRef, xI2, yI2=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">group_by_axis</a>(2*correlationAmp.theta[:,1,:].ravel())        </div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        cor2hAxs=MT.plot_errorbar_and_hist(correlationAmp.t[:,1].ravel()[xI2], correlationAmp.sig[:,1].ravel()[xI2]*cos(2*correlationAmp.theta[:,1].ravel()[xI2]), err2h.ravel()[xI2], subplotSpec=gs[3], sharexs=[pointAxs[0], <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        MT.plot_errorbar_and_hist(correlationAmp.t[:,1].ravel()[yI2], correlationAmp.sig[:,1].ravel()[yI2]*sin(2*correlationAmp.theta[:,1].ravel()[yI2]), err2h.ravel()[yI2], *cor2hAxs)</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        subplot(gs[4]).plot(correlationAmp.t[:,1].ravel(), correlationAmp.chi2[:,1].ravel(),<span class="stringliteral">&#39;o&#39;</span>)</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="comment">#chi2Axs=MT.plot_scatter_and_hist(correlationAmp.t[:,0].ravel(), correlationAmp.chi2[:,0].ravel(), subplotSpec=gs[2], sharexs=[pointAxs[0],None])</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> MT.nearby_angles(thetaRef, 0, 0.1):</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        corAxs[0].set_title(<span class="stringliteral">&#39;Reference angle: {0}&#39;</span>.format(thetaRef/pi*180))</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    tight_layout()</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment"># Not functional anymore</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">#     </span></div>
<div class="line"><a name="l01260"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a40e964ab0b81bcee6065cfa0b5bde422"> 1260</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a40e964ab0b81bcee6065cfa0b5bde422">view_sidereal</a>(seqTup, sidFitTup, labFrameTup=None):</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    figure()</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    fx=<span class="keyword">lambda</span> th, ax: ax*sin(th)</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    fy=<span class="keyword">lambda</span> th, ay: ay*cos(th)</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    f=<span class="keyword">lambda</span> th, ax, ay: ax*sin(th) + ay*cos(th)</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    gs=GridSpec(2,1)</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    sigAxs=MT.plot_errorbar_and_hist(seqTup.t.ravel(), seqTup.sig.ravel(), seqTup.err.ravel(), subplotSpec=gs[0])</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordflow">if</span> seqTup.chi2 <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        chiAxs=MT.plot_scatter_and_hist(seqTup.t, seqTup.chi2, gs[1])</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        chiAxs[0].set_title(<span class="stringliteral">r&#39;$\chi^2$&#39;</span>)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    sigRot=MT.rotMat2d(-sidFitTup.labTheta[0]).dot(sidFitTup.sig)</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    errRot=abs(MT.rotMat2d(-sidFitTup.labTheta[0]).dot(sidFitTup.err)) <span class="comment">#This is very fragile- should do full covariance in here.</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    sigAxs[0].plot(seqTup.t, f(2*pi*seqTup.t + 0*sidFitTup.labTheta[0], *sidFitTup.sig),</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    label=<span class="stringliteral">&quot;$X$:{:.3} $\pm$ {:.3}, $Y$:{:.3} $\pm$ {:.3}&quot;</span>.format(</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    sigRot[0,0], errRot[0,0], sigRot[0,1], errRot[0,1])</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    )</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    sigAxs[0].legend()</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    sigAxs[0].set_title(<span class="stringliteral">&#39;Sidereal Signal (lab: $S_{0:.3}={1:.3} \pm {2:.3}$, $S_{3:.3}= {4:.3} \pm {5:.3}$&#39;</span>.format(</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                labFrameTup.labTheta[0]/pi*180, labFrameTup.sig[0], labFrameTup.err[0], </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                labFrameTup.labTheta[1]/pi*180, labFrameTup.sig[1], labFrameTup.err[1] ))</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    </div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="comment">#Could also do another here if we&#39;re fitting both</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="comment">#bothAx1.legend()</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordflow">if</span> 0:</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <span class="keywordflow">for</span> T, A, LV <span class="keywordflow">in</span> ([seqT_0, seqSig1_0, sidAmp0], [seqT_90, seqSig1_90, sidAmp90]):</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            <span class="keywordflow">if</span> len(A)&gt;3:</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                axLV.plot(T, f(2*pi*T+ LV[0][0] -0*thetaRef, *LV[1]  ), label=<span class="stringliteral">&quot;$_X$:{:.3} $\pm$ {:.3}, $_Y$:{:.3} $\pm$ {:.3}&quot;</span>.format(LV[1][0], sqrt(LV[2][0]), LV[1][1], sqrt(LV[2][1])))</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                vprint(<span class="stringliteral">&quot;Need at least 3 sequence points&quot;</span>)</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        axLV.text( 0.5, 0.05, <span class="stringliteral">r&#39;$\theta_0 = {:.3}$&#39;</span>.format(thetaRef/pi*180), bbox=dict(facecolor=<span class="stringliteral">&#39;grey&#39;</span>, alpha=0.1), transform=axLV.transAxes, fontsize=16)</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        axLV.legend(loc=0)</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div>
<div class="line"><a name="l01296"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#adb6ea3b115ad55320acf0ef8f3ee76eb"> 1296</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#adb6ea3b115ad55320acf0ef8f3ee76eb">combine_angle_amps</a>(ampL, plot=False):</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        ampL=[amp <span class="keywordflow">for</span> amp <span class="keywordflow">in</span> ampL <span class="keywordflow">if</span> amp <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>]</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        ts = [ sAmp.t <span class="keywordflow">for</span> sAmp <span class="keywordflow">in</span> ampL]</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="keywordflow">if</span> ampL:</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            <span class="comment">#Might not rotate in this case, but just in case</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            (ths, ys, covs)= zip(*[ MT.rotate_quadrature_sample(sAmp.labTheta, sAmp.sig, sAmp.err) <span class="keywordflow">for</span> sAmp <span class="keywordflow">in</span> ampL <span class="keywordflow">if</span> sAmp <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            ys=array(ys)</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            errs=array([sqrt(cov.diagonal()) <span class="keywordflow">for</span> cov <span class="keywordflow">in</span> covs]) <span class="comment">#cheat and throw away off-diagonals</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            ts=array(ts)</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            <span class="keywordflow">if</span> ts.ndim &lt; ys.ndim:</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                ts=tile(ts[:,newaxis],2)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            mn, wEr, apparentUnc, chi2= MT.weightedStats(ys, 1./errs**2, axis=0, bReturnChi2=<span class="keyword">True</span>)</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <span class="comment">#calcedUnc=sqrt(nansum(errs**2,axis=0)/sum(~isnan(errs))**2)</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            calcedUnc=1/sqrt(nansum(1/errs**2,axis=0))</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            combAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a8dd105859db0f7ebef805efb3c08dfb7">SiderealFitData</a>(mean(ts), mn, apparentUnc, chi2, <span class="keywordtype">None</span>, <span class="keywordtype">None</span>, <span class="keywordtype">None</span>) </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            ts=ys=errs=array([])</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            combAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a8dd105859db0f7ebef805efb3c08dfb7">SiderealFitData</a>(*(7*[<span class="keywordtype">None</span>]))</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="keywordflow">if</span> plot:</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            <span class="keywordflow">if</span> isinstance(plot, Axes):</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                axL=[plot, plot]</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            <span class="keywordflow">elif</span> hasattr(plot, <span class="stringliteral">&quot;__getitem__&quot;</span>):</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                axL=plot <span class="comment">#assume it&#39;s a list with two axes</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                figure()</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                axL=[gca(), gca()]</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="keywordflow">for</span> t, y, e, ax <span class="keywordflow">in</span> zip(ts.T, ys.T, errs.T, axL):</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                ax.errorbar( t, y, e, fmt=<span class="stringliteral">&#39;.&#39;</span>) </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;            axL[0].set_title(<span class="stringliteral">&#39;x&#39;</span>)</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;            axL[1].set_title(<span class="stringliteral">&#39;y&#39;</span>)</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <span class="comment">#gdInd=~(isnan(ys) | isinf(ys) | isinf(errs))</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="comment">#ys=ys[gdInd]</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <span class="comment">#errs=errs[gdInd]</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="comment">#if sum(~isnan(errs)) &lt;1:</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            <span class="comment">#return None</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="comment">#sm.WLS(</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="keywordflow">return</span> combAmp</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="comment">#return mn, calcedUnc, apparentUnc, wEr, chi2</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">##</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment"># </span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">#         Todos:</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">#             - Filter out sequence points by chi squared, error bar, or even deviation from the mean</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">#                 - Low pass filter first, then look at slope or remaining RMS for weighting value</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">#                 - Histogram the string points and try to find any common signature to the outliers</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">#             - Do a multiple regression for the correlation data vs the signal data</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">#             - Output extra details like &#39;cosmic&#39; angle, and mean signal in the lab-frame.</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">#         </span></div>
<div class="line"><a name="l01349"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a1aca1da7012fa44af8ba6fb057c7ed1b"> 1349</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a1aca1da7012fa44af8ba6fb057c7ed1b">spSearchSet</a>(timestamp, rSpec, sigWindow, bgWindow, startTime=-inf, endTime=inf, bPlotAll=True ): </div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="comment">####################LOAD DATA##########################</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="keywordflow">if</span> hasattr(timestamp, <span class="stringliteral">&#39;fastD&#39;</span>): <span class="comment">#If we&#39;ve actually been handed a dataset, not a timestamp</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            D=timestamp</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="keywordflow">else</span>: <span class="comment">#Load one</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            D=SPDataSet(timestamp, startTime=startTime, endTime=endTime)</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="comment">###################CUT AND PROCESS INTO POINTS###################</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        rawAmp0=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a29a04cecefb141502380f4e43bc1d06d">RawData</a>(t=D.fastD[0], sig=D.fastD[1])</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        trigTimes=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af8a48b74a6d4e725e2409329126076a6">makeTriggers</a>(D.fastD[0], rSpec, bIncludeExtraRot=<span class="keyword">True</span>);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        cutAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aa45dbb6291e4944f3ba2718a3d0ee001">preprocess_raw</a>(rawAmp0, trigTimes, sigWindow)</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        pointAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5d91f2e7930fdc007f010659068307f9">process_raw</a>(cutAmp)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="keywordflow">if</span> bPlotAll:</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9c4d4bc9bf9302d2690f560af0d9982b">view_raw</a>(rawAmp0, cutAmp, trigTimes)</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="comment">#################### FILTER OUT BAD POINTS#######################</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="keywordflow">if</span> 0:</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            filterSensorNameL= [<span class="stringliteral">&#39;Tilt Sensor 1&#39;</span>],</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            rawSig, badM= <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aefa37b595edec764011c69c3202787f6">filterBySensors</a>(cutAmp,</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                        sensDataL=getSensors(D, filterSensorNameL),</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                        bView= bPlotAll)</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;         </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <span class="comment">##################PROCESS BY SEQUENCE (CORRELATION)####################</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        seqAmp=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7265a1148ca13e5fb7961b297a214d13">process_points</a>(D.apparatusAngles, pointAmp, cutAmp )</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="comment">#view_correlations(seqAmp)</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <span class="comment">################PROCESS ALL SEQUENCES, I.E. WHOLE SET####################</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        <span class="comment">## Divide the sequences into groups (e.g. EW and NS) and process them, returning also the lab-fram numbers</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        labAmps, sidAmps, seqAmps= <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae43119e40ee34e8e5f67a1088548adb6">split_and_process_sequences</a>(seqAmp)</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a40e964ab0b81bcee6065cfa0b5bde422">view_sidereal</a>(seqAmps[0], sidAmps[0] )</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a40e964ab0b81bcee6065cfa0b5bde422">view_sidereal</a>(seqAmps[1], sidAmps[1] )</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a40e964ab0b81bcee6065cfa0b5bde422">view_sidereal</a>(seqAmps[2], sidAmps[2] )</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <span class="keywordflow">return</span> labAmps, sidAmps<span class="comment">#, sidAmpAlt</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="keywordflow">if</span> __name__==<span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="keyword">from</span> pylab <span class="keyword">import</span> *</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <span class="keyword">from</span> scipy <span class="keyword">import</span> random</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordflow">if</span> 0:</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="comment"># Check string analysis:</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aaea13a6ab57b30bea3669d56fd489e30"> 1393</a></span>&#160;        N=10000</div>
<div class="line"><a name="l01394"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae6715e84e2c13a885096710a851aba3a"> 1394</a></span>&#160;        t=linspace(0,10,N)</div>
<div class="line"><a name="l01395"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a68243cfba6d3074cf6381b76546eec71"> 1395</a></span>&#160;        dat=(arange(N)%2 -0.5)*1</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        dat+=random.normal(0, size=N)</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        plot(t,dat)</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        vprint(stringAnalysis(t, dat, ones(N)*0.5))</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    </div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordflow">if</span> 0: <span class="comment">#Check MakeTestData</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        bTest=<span class="keyword">True</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        dat=MakeTestData(<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#abeb96363789885a36812850590fbfbab">RotationSpec</a>(startingAngle=0, delay=9, interval=30, numRotations=20, rotAngles=[180], extraRotAngle=90), amp=1, sigma=0.01, zeroingTime=500)</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="keywordflow">if</span> 0:</div>
<div class="line"><a name="l01406"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae11ccbd488015737fccc78456a5a112f"> 1406</a></span>&#160;        D=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1loadSPFiles.html#ac05316301b88456778eaedde597c8ed5">loadSet</a>(<span class="stringliteral">&#39;5348.82&#39;</span>, startTime=5348.86)</div>
<div class="line"><a name="l01407"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7fe775d9cf2e94f97127d699a8b92579"> 1407</a></span>&#160;        nameL=[<span class="stringliteral">&#39;Tilt Sensor 1&#39;</span>]</div>
<div class="line"><a name="l01408"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a0fa8a32d68b3b6a1486926b952bd3676"> 1408</a></span>&#160;        rSpec=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#abeb96363789885a36812850590fbfbab">RotationSpec</a>(startingAngle=0, delay=9, interval=30, numRotations=20, rotAngles=[-180], extraRotAngle=-90)</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        [ts1]=getSensors(D, nameL)</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="comment">#out=sliceReduceData( ts1[0], ts1[1], </span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                            <span class="comment">#trigTimes + secs2sd(sigWindow.offset), secs2sd(sigWindow.duration) )</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a4dc94cbb119a397cfee47da5a4681676"> 1412</a></span>&#160;        window=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5f881c246a0ac49955b33746df6c379b">Window</a>(offset=-5.0, duration=4)</div>
<div class="line"><a name="l01413"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a165fa263d040e95cba983de350ee563f"> 1413</a></span>&#160;        trigTimes=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af8a48b74a6d4e725e2409329126076a6">makeTriggers</a>(ts1[0], rSpec, bIncludeExtraRot=<span class="keyword">True</span>);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        ts1Ts, [_, ts1CutSig, ts1CutErr], ts1CutIndxL = <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#afac5173c60ef10bac3b5eafb40f7efef">sliceReduceData</a>( ts1[0], ts1[1], trigTimes + <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(window.offset), <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">secs2sd</a>(window.duration) ) </div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="comment">#M=nanmean(ts1CutSig.ravel())</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        badM, ts1SM=MT.findOutliers(ts1CutSig.ravel(), windowLen=50, sigmas=3, bReturnMeanLine=<span class="keyword">True</span>)</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        figure()</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        <span class="comment">#as</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        plot(ts1Ts.ravel(), ts1CutSig.ravel(),<span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        plot(ts1Ts.ravel()[badM], ts1CutSig.ravel()[badM],<span class="stringliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        plot(ts1Ts.ravel(), ts1SM, lw=2)</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">if</span> 0: <span class="comment">#Check analysis</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ab1cf4f0f232b2ccd32f08baa27263f1b"> 1423</a></span>&#160;        timestamps=[</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            <span class="stringliteral">&#39;5227.40&#39;</span>,</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;            <span class="comment">#&#39;5310.41&#39;,</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            <span class="comment">#&#39;5318.41&#39;,</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            <span class="comment">#&#39;5348.86&#39;,</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        ]</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        rSpec=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#abeb96363789885a36812850590fbfbab">RotationSpec</a>(startingAngle=0, delay=9, interval=10, numRotations=20, rotAngles=[-180], extraRotAngle=-90)</div>
<div class="line"><a name="l01430"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ab8ea55b3a0adfc5e8090a9a40db96e5a"> 1430</a></span>&#160;        res=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a1aca1da7012fa44af8ba6fb057c7ed1b">spSearchSet</a>(</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            MakeTestData(rSpec, amp=10.05, sigma=2, N=800000, phi=-0.15*pi, zeroingTime=30, fracDev=0.00, sizeDev=50.0),</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            rSpec,</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;            <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5f881c246a0ac49955b33746df6c379b">Window</a>(offset=-3, duration=2), <a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5f881c246a0ac49955b33746df6c379b">Window</a>(offset=-1,duration=1),</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            bPlotAll=<span class="keyword">True</span>,</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;            )</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keywordflow">if</span> 0:</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="keyword">from</span> SPDataSet <span class="keyword">import</span> SPDataSet</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        rSpec=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#abeb96363789885a36812850590fbfbab">RotationSpec</a>(startingAngle=0, delay=9, interval=10, numRotations=20, rotAngles=[-180], extraRotAngle=-90)</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        sd,sig=<a class="code" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae90ba18ae292290722e197cf242d8721">makeTestData</a>(</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        rSpec, amp=10.05, sigma=2, N=800000, phi=-0.15*pi, zeroingTime=30, fracDev=0.00, sizeDev=50.0)</div>
<div class="line"><a name="l01441"></a><span class="lineno"><a class="line" href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5e62fc21df71cfdd96a1c0048b264295"> 1441</a></span>&#160;        ds=SPDataSet(<span class="stringliteral">&#39;test&#39;</span>, preloadDict={<span class="stringliteral">&#39;fastD&#39;</span>: [sd, sig, <span class="stringliteral">&#39;sig&#39;</span>]}, rSpec=rSpec )</div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_adb6ea3b115ad55320acf0ef8f3ee76eb"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#adb6ea3b115ad55320acf0ef8f3ee76eb">repo.programs.pythonpackages.pr.SPfuncs.combine_angle_amps</a></div><div class="ttdeci">def combine_angle_amps</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l01296">SPfuncs.py:1296</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_af195e86c16fec9d60d1ac20dbe5d1f19"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af195e86c16fec9d60d1ac20dbe5d1f19">repo.programs.pythonpackages.pr.SPfuncs.view_correlation_filtering</a></div><div class="ttdeci">def view_correlation_filtering</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l01169">SPfuncs.py:1169</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a9c4d4bc9bf9302d2690f560af0d9982b"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9c4d4bc9bf9302d2690f560af0d9982b">repo.programs.pythonpackages.pr.SPfuncs.view_raw</a></div><div class="ttdeci">def view_raw</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l01135">SPfuncs.py:1135</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a5a727d85f97fb1e1e7370fbca3b1d1ea"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5a727d85f97fb1e1e7370fbca3b1d1ea">repo.programs.pythonpackages.pr.SPfuncs.group_by_axis</a></div><div class="ttdeci">def group_by_axis</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00593">SPfuncs.py:593</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_afac5173c60ef10bac3b5eafb40f7efef"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#afac5173c60ef10bac3b5eafb40f7efef">repo.programs.pythonpackages.pr.SPfuncs.sliceReduceData</a></div><div class="ttdeci">def sliceReduceData</div><div class="ttdoc">Cut the given x data at points starting from x0, and going to x0+delta_x, and perform the functions i...</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00141">SPfuncs.py:141</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a9ae89d50fa931a7cc863400505be38b1"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9ae89d50fa931a7cc863400505be38b1">repo.programs.pythonpackages.pr.SPfuncs.process_continuous_raw</a></div><div class="ttdeci">def process_continuous_raw</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00939">SPfuncs.py:939</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a45a8e352a69cc8a225a32134c87cd120"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a45a8e352a69cc8a225a32134c87cd120">repo.programs.pythonpackages.pr.SPfuncs.view_correlations</a></div><div class="ttdeci">def view_correlations</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l01198">SPfuncs.py:1198</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a792112113be3784fc089059c6eed4ff1"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a792112113be3784fc089059c6eed4ff1">repo.programs.pythonpackages.pr.SPfuncs.rotate_sequence_amps</a></div><div class="ttdeci">def rotate_sequence_amps</div><div class="ttdoc">N=100 th=linspace(0,20,N)%(2*pi) sa= CorrelationData(linspace(0,1,N), sin(2*th), ones(N)) ...</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00628">SPfuncs.py:628</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a26157a1627869c31bfa6e494e5caf311"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a26157a1627869c31bfa6e494e5caf311">repo.programs.pythonpackages.pr.SPfuncs.stringSimple5pt</a></div><div class="ttdeci">def stringSimple5pt</div><div class="ttdoc">Calculate 5pt strings and errors. </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00190">SPfuncs.py:190</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a9d03b1e8bb9325cdab8fa026d6cdbbe3"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9d03b1e8bb9325cdab8fa026d6cdbbe3">repo.programs.pythonpackages.pr.SPfuncs.secs2sd</a></div><div class="ttdeci">def secs2sd</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00028">SPfuncs.py:28</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_ae33ce81936d04fd605560ec75ffe4a12"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae33ce81936d04fd605560ec75ffe4a12">repo.programs.pythonpackages.pr.SPfuncs.subtract_correlations</a></div><div class="ttdeci">def subtract_correlations</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00720">SPfuncs.py:720</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a154be474c56db17750f8232efe410d54"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a154be474c56db17750f8232efe410d54">repo.programs.pythonpackages.pr.SPfuncs.mgStringHarmonics</a></div><div class="ttdeci">def mgStringHarmonics</div><div class="ttdoc">Input measurements x taken at angles theta0+ n* dtheta (assumed to be evenly spaced) and return harmo...</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00339">SPfuncs.py:339</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a1ffb0a48d6d36a1260a65e82c4604ce2"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a1ffb0a48d6d36a1260a65e82c4604ce2">repo.programs.pythonpackages.pr.SPfuncs.PointData</a></div><div class="ttdeci">tuple PointData</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00036">SPfuncs.py:36</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a1aca1da7012fa44af8ba6fb057c7ed1b"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a1aca1da7012fa44af8ba6fb057c7ed1b">repo.programs.pythonpackages.pr.SPfuncs.spSearchSet</a></div><div class="ttdeci">def spSearchSet</div><div class="ttdoc">Todos: </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l01349">SPfuncs.py:1349</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1loadSPFiles_html_ac05316301b88456778eaedde597c8ed5"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1loadSPFiles.html#ac05316301b88456778eaedde597c8ed5">repo.programs.pythonpackages.pr.loadSPFiles.loadSet</a></div><div class="ttdeci">def loadSet</div><div class="ttdoc">OLD Load all the data associated with . </div><div class="ttdef"><b>Definition:</b> <a href="loadSPFiles_8py_source.html#l00082">loadSPFiles.py:82</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a87aac33304db20fd58d7a3625061cca6"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a87aac33304db20fd58d7a3625061cca6">repo.programs.pythonpackages.pr.SPfuncs.sliceSorted</a></div><div class="ttdeci">def sliceSorted</div><div class="ttdoc">Cut up the times  into sections that start at t_0 and and at t_end OR t_0 + delta_t if they&#39;re all th...</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00108">SPfuncs.py:108</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_ae90ba18ae292290722e197cf242d8721"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae90ba18ae292290722e197cf242d8721">repo.programs.pythonpackages.pr.SPfuncs.makeTestData</a></div><div class="ttdeci">def makeTestData</div><div class="ttdoc">Make up some data that the experiment might have measured. </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00532">SPfuncs.py:532</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a98ebdcd3ceb3fa1b7bc74e8caf64b50d"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98ebdcd3ceb3fa1b7bc74e8caf64b50d">repo.programs.pythonpackages.pr.SPfuncs.LabSetData</a></div><div class="ttdeci">tuple LabSetData</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00039">SPfuncs.py:39</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a9cc828a26b8f8d72c9c5c86bd951f8e8"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a9cc828a26b8f8d72c9c5c86bd951f8e8">repo.programs.pythonpackages.pr.SPfuncs.addFakeData</a></div><div class="ttdeci">def addFakeData</div><div class="ttdoc">Add fake signal/noise to an existing signal. </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00471">SPfuncs.py:471</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a7fb1286952274a8a185975238894be9d"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7fb1286952274a8a185975238894be9d">repo.programs.pythonpackages.pr.SPfuncs.stringSimple3pt</a></div><div class="ttdeci">def stringSimple3pt</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00170">SPfuncs.py:170</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_aa986fff9d1f1b5354e43e972289e5844"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aa986fff9d1f1b5354e43e972289e5844">repo.programs.pythonpackages.pr.SPfuncs.process_sequences_multifit</a></div><div class="ttdeci">def process_sequences_multifit</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00641">SPfuncs.py:641</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_abeb96363789885a36812850590fbfbab"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#abeb96363789885a36812850590fbfbab">repo.programs.pythonpackages.pr.SPfuncs.RotationSpec</a></div><div class="ttdeci">tuple RotationSpec</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00034">SPfuncs.py:34</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a7590e0785adc48ccbabea8d0eccda514"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7590e0785adc48ccbabea8d0eccda514">repo.programs.pythonpackages.pr.SPfuncs.getHarmonicsFit</a></div><div class="ttdeci">def getHarmonicsFit</div><div class="ttdoc">Calculate the harmonics present in the data x corresponding to phases theta. </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00245">SPfuncs.py:245</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a29a04cecefb141502380f4e43bc1d06d"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a29a04cecefb141502380f4e43bc1d06d">repo.programs.pythonpackages.pr.SPfuncs.RawData</a></div><div class="ttdeci">tuple RawData</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00035">SPfuncs.py:35</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_acb6d178d4325b6c3d8fec4f8197d6819"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#acb6d178d4325b6c3d8fec4f8197d6819">repo.programs.pythonpackages.pr.SPfuncs.renameFieldMaybe</a></div><div class="ttdeci">def renameFieldMaybe</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00457">SPfuncs.py:457</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a98d08fa254a21b0b0895f424f7006dbd"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a98d08fa254a21b0b0895f424f7006dbd">repo.programs.pythonpackages.pr.SPfuncs.process_sequences</a></div><div class="ttdeci">def process_sequences</div><div class="ttdoc">Process sequence values, sSig, into final numbers. </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00895">SPfuncs.py:895</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a5d91f2e7930fdc007f010659068307f9"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5d91f2e7930fdc007f010659068307f9">repo.programs.pythonpackages.pr.SPfuncs.process_raw</a></div><div class="ttdeci">def process_raw</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00808">SPfuncs.py:808</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a7265a1148ca13e5fb7961b297a214d13"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a7265a1148ca13e5fb7961b297a214d13">repo.programs.pythonpackages.pr.SPfuncs.process_points</a></div><div class="ttdeci">def process_points</div><div class="ttdoc">Turn groups of points into sequences- except currently we go directly from a a group of &#39;cuts&#39; (i...</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00829">SPfuncs.py:829</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_aca5c571c3ee666190d0568fbcd72f1a9"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aca5c571c3ee666190d0568fbcd72f1a9">repo.programs.pythonpackages.pr.SPfuncs.sd2secs</a></div><div class="ttdeci">def sd2secs</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00030">SPfuncs.py:30</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_ae43119e40ee34e8e5f67a1088548adb6"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#ae43119e40ee34e8e5f67a1088548adb6">repo.programs.pythonpackages.pr.SPfuncs.split_and_process_sequences</a></div><div class="ttdeci">def split_and_process_sequences</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l01089">SPfuncs.py:1089</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_aba724f914a5cc838851518564a1f5d84"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aba724f914a5cc838851518564a1f5d84">repo.programs.pythonpackages.pr.SPfuncs.getRotationsFromRSpec</a></div><div class="ttdeci">def getRotationsFromRSpec</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00043">SPfuncs.py:43</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a8dd105859db0f7ebef805efb3c08dfb7"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a8dd105859db0f7ebef805efb3c08dfb7">repo.programs.pythonpackages.pr.SPfuncs.SiderealFitData</a></div><div class="ttdeci">tuple SiderealFitData</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00038">SPfuncs.py:38</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a40e964ab0b81bcee6065cfa0b5bde422"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a40e964ab0b81bcee6065cfa0b5bde422">repo.programs.pythonpackages.pr.SPfuncs.view_sidereal</a></div><div class="ttdeci">def view_sidereal</div><div class="ttdoc">Not functional anymore. </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l01260">SPfuncs.py:1260</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_af8a48b74a6d4e725e2409329126076a6"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#af8a48b74a6d4e725e2409329126076a6">repo.programs.pythonpackages.pr.SPfuncs.makeTriggers</a></div><div class="ttdeci">def makeTriggers</div><div class="ttdoc">Construct a set of triggers by analysing the timing for the signal. </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00071">SPfuncs.py:71</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a2533afa952ea007cfad4a1deb6a607a5"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a2533afa952ea007cfad4a1deb6a607a5">repo.programs.pythonpackages.pr.SPfuncs.getAnglesFromRSpec</a></div><div class="ttdeci">def getAnglesFromRSpec</div><div class="ttdoc">Return angles for the sequence defined by , repeated  times. </div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00056">SPfuncs.py:56</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a97ee543cf8ac7b27443cbfe8ff2e20f3"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a97ee543cf8ac7b27443cbfe8ff2e20f3">repo.programs.pythonpackages.pr.SPfuncs.CorrelationData</a></div><div class="ttdeci">tuple CorrelationData</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00037">SPfuncs.py:37</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_aa45dbb6291e4944f3ba2718a3d0ee001"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aa45dbb6291e4944f3ba2718a3d0ee001">repo.programs.pythonpackages.pr.SPfuncs.preprocess_raw</a></div><div class="ttdeci">def preprocess_raw</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00779">SPfuncs.py:779</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_a5f881c246a0ac49955b33746df6c379b"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#a5f881c246a0ac49955b33746df6c379b">repo.programs.pythonpackages.pr.SPfuncs.Window</a></div><div class="ttdeci">tuple Window</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00033">SPfuncs.py:33</a></div></div>
<div class="ttc" id="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs_html_aefa37b595edec764011c69c3202787f6"><div class="ttname"><a href="namespacerepo_1_1programs_1_1pythonpackages_1_1pr_1_1SPfuncs.html#aefa37b595edec764011c69c3202787f6">repo.programs.pythonpackages.pr.SPfuncs.filterBySensors</a></div><div class="ttdeci">def filterBySensors</div><div class="ttdef"><b>Definition:</b> <a href="SPfuncs_8py_source.html#l00861">SPfuncs.py:861</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="SPfuncs_8py.html">SPfuncs.py</a></li>
    <li class="footer">Generated on Sat Jan 24 2015 18:30:33 for Test Cmd Line by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
